---
title: 系统设计
tags:
  - 系统设计
  - 面经
categories:
  - 面经
keywords:
  - 面经
description: 系统设计
abbrlink: 17778
date: 2024-06-27 23:39:07
updated: 2024-06-28 00:15:15
top_img: https://s2.loli.net/2024/06/27/xFVKjeyNk45c8wv.png
comments:
cover: https://s2.loli.net/2024/06/27/OKRYQHdoCfGmgxr.png
toc:
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
abcjs:
---

### 实现多个客户端访问一个服务端
使用`Socket`编程来实现一个简单的客户端-服务端模型。

服务端代码：
```python
import socket
import threading

# 定义服务端的IP地址和端口
server_ip = '127.0.0.1'
server_port = 12345

# 创建Socket对象
server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_socket.bind((server_ip, server_port))
server_socket.listen(5)  # 最大连接数

print(f"服务器启动，监听端口: {server_port}")

def handle_client(client_socket):
    while True:
        try:
            message = client_socket.recv(1024).decode('utf-8')
            if not message:
                break
            print(f"收到消息: {message}")
            response = f"服务器收到消息: {message}"
            client_socket.send(response.encode('utf-8'))
        except ConnectionResetError:
            break
    client_socket.close()

while True:
    client_socket, client_address = server_socket.accept()
    print(f"连接来自: {client_address}")
    client_handler = threading.Thread(target=handle_client, args=(client_socket,))
    client_handler.start()
```
客户端代码：
```python
import socket

# 定义服务端的IP地址和端口
server_ip = '127.0.0.1'
server_port = 12345

# 创建Socket对象
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect((server_ip, server_port))

while True:
    message = input("请输入发送给服务器的消息: ")
    if message.lower() == 'exit':
        break
    client_socket.send(message.encode('utf-8'))
    response = client_socket.recv(1024).decode('utf-8')
    print(f"服务器回应: {response}")

client_socket.close()
```
服务端代码:
- 创建一个`Socket`对象并绑定到指定的IP地址和端口。
- 使用`listen()`方法开始监听连接。
- 当有客户端连接时，接受连接并创建一个新的线程来处理该客户端的通信。
- `handle_client`函数负责处理与客户端的通信，包括接收消息和发送响应。

客户端代码:
- 创建一个`Socket`对象并连接到服务端的IP地址和端口。
- 进入一个循环，从用户输入获取消息并发送到服务端。
- 接收服务端的响应并打印出来。
- 当用户输入`'exit'`时，关闭连接。

这种方法使用多线程来处理多个客户端的连接，每个客户端都有一个单独的线程来处理，从而实现了多个客户端访问一个服务端。

### 置顶和加精如何设计
执行置顶和加精的设计通常涉及后端系统的多个层面，包括数据库设计、API接口设计、权限控制以及前端展示等。以下是一个基于通用场景的设计方案：

1. 数据库设计：在数据库中需要为帖子(或文章)表添加相应的字段以支持置顶和加精功能。常见的做法是为帖子表添加两个字段：
   - `is_top`(或类似名称)：用于标识帖子是否置顶。该字段通常为布尔类型或整型(0表示未置顶，1表示已置顶)。
   - `is_wonderful`(或类似名称)：用于标识帖子是否加精。该字段同样为布尔类型或整型(0表示未加精，1表示已加精)。
2. API接口设计：在API层面，需要设计相应的接口来支持置顶和加精操作。
   - 置顶接口：接受帖子的ID作为参数，将对应帖子的`is_top`字段设置为1(或相应的值)，并返回操作结果。
   - 取消置顶接口：与置顶接口类似，但将`is_top`字段设置回0(或相应的值)。
   - 加精接口：接受帖子的ID作为参数，将对应帖子的`is_wonderful`字段设置为1(或相应的值)，并返回操作结果。
   - 取消加精接口：与加精接口类似，但将`is_wonderful`字段设置回0(或相应的值)。
3. 权限控制：在执行置顶和加精操作时，还需要进行权限控制，以确保只有具有相应权限的用户(如版主或管理员)才能执行这些操作。这通常通过以下方式实现： 
   - 用户认证：首先，用户需要登录系统，并通过身份验证。
   - 角色和权限检查：系统检查用户的角色(如版主、管理员等)和权限，以确定用户是否有权执行置顶或加精操作。
4. 前端展示：在前端展示方面，需要为具有相应权限的用户显示置顶和加精的按钮或链接，并在帖子列表中根据帖子的`is_top`和`is_wonderful`字段的值来展示相应的标识(如置顶标签、加精图标等)。
5. 额外考虑
   - 数据一致性：在执行置顶和加精操作时，需要确保数据的一致性。例如，如果系统只允许一个帖子置顶，那么在置顶新帖子时需要先取消其他帖子的置顶状态。
   - 性能优化：对于高并发的系统，需要考虑如何优化置顶和加精操作的性能。例如，可以通过缓存技术来减少数据库的访问次数。
   - 日志记录：为了追踪和审计操作，系统应该记录每次置顶和加精操作的详细信息，包括操作时间、操作人、帖子ID等。
