{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/image/k8s部署云笔记系统/1.png","path":"image/k8s部署云笔记系统/1.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/3.png","path":"image/k8s部署云笔记系统/3.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/2.png","path":"image/k8s部署云笔记系统/2.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/4.png","path":"image/k8s部署云笔记系统/4.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/5.png","path":"image/k8s部署云笔记系统/5.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/6.png","path":"image/k8s部署云笔记系统/6.png","modified":0,"renderable":0},{"_id":"source/image/k8s部署云笔记系统/可莉.png","path":"image/k8s部署云笔记系统/可莉.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/6.png","path":"image/云笔记系统扩容/6.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/add-labels.png","path":"image/云笔记系统扩容/add-labels.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/backup-desktop.png","path":"image/云笔记系统扩容/backup-desktop.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/backup.png","path":"image/云笔记系统扩容/backup.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/delete-pod.png","path":"image/云笔记系统扩容/delete-pod.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/expand.png","path":"image/云笔记系统扩容/expand.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/login.png","path":"image/云笔记系统扩容/login.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/pod-after-deleted.png","path":"image/云笔记系统扩容/pod-after-deleted.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/pod-after-deploy.png","path":"image/云笔记系统扩容/pod-after-deploy.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/pod-deploy.png","path":"image/云笔记系统扩容/pod-deploy.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/pod-node.png","path":"image/云笔记系统扩容/pod-node.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/pod.png","path":"image/云笔记系统扩容/pod.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/setting.png","path":"image/云笔记系统扩容/setting.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/shutdown.png","path":"image/云笔记系统扩容/shutdown.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/vmware.png","path":"image/云笔记系统扩容/vmware.png","modified":0,"renderable":0},{"_id":"source/image/云笔记系统扩容/xftp.png","path":"image/云笔记系统扩容/xftp.png","modified":0,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/Valine.min.js","path":"js/Valine.min.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/alipay.JPG","path":"img/alipay.JPG","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/wechat.JPG","path":"img/wechat.JPG","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/assets/头像.JPG","path":"img/assets/头像.JPG","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/assets/雷电将军.jpg","path":"img/assets/雷电将军.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/background/樱花1.jpg","path":"img/background/樱花1.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/background/樱花2.jpg","path":"img/background/樱花2.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/background/灯笼.jpg","path":"img/background/灯笼.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/cover/久岐忍.jpg","path":"img/cover/久岐忍.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/cover/胡桃.JPG","path":"img/cover/胡桃.JPG","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/top_img/久岐忍.jpg","path":"img/top_img/久岐忍.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/top_img/久岐忍3.jpg","path":"img/top_img/久岐忍3.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/top_img/妮露.jpg","path":"img/top_img/妮露.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/top_img/妮露1.jpg","path":"img/top_img/妮露1.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"4bea7c63a8123ff9b87f74cb1ef1c4388efd940c","modified":1695195358048},{"_id":"source/_posts/hello-world.md","hash":"c4dabc86aa226113f500f9c79b3daab53cc7f19e","modified":1695395735497},{"_id":"source/_data/link.yml","hash":"f98992c0731559bcdc7fdc1af1f93b8dbae10649","modified":1694621161236},{"_id":"source/_posts/k8s部署云笔记系统.md","hash":"31daab24a778ebf1f415e6f4bffb2ce4156a35e0","modified":1695395735500},{"_id":"source/about/index.md","hash":"e1087c5a10885ebb8b7fa256b18f8f4cb4fd32de","modified":1693482407429},{"_id":"source/_posts/test.md","hash":"ff1e5ebef5f7564df56721511031e686406c4248","modified":1695395735500},{"_id":"source/music/index.md","hash":"35648eb9af8d7b9fe29bb63e7b321c9cda6fefa0","modified":1693482586718},{"_id":"source/categories/index.md","hash":"8327a464fbe3f93cac6b89401e6315c63eba895f","modified":1693482273118},{"_id":"source/_posts/云笔记系统扩容.md","hash":"404c0508b6f5d77bd31eb7fbfe33653f6d68c710","modified":1695395735499},{"_id":"source/pictures/index.md","hash":"94222c03b6451f9b5a556cd703fc9cde2cfcd75d","modified":1695138905212},{"_id":"source/tags/index.md","hash":"e9b98a407b92523541efe47ea7d4ad42e157124e","modified":1694620980990},{"_id":"source/movies/index.md","hash":"9fdcdf109e4daff4f0a66d140a764c5ce2a55dd7","modified":1693482586713},{"_id":"source/link/index.md","hash":"7a17f4dc4cf4eae0b205dceccf4d76c81d226f58","modified":1693482301378},{"_id":"source/image/k8s部署云笔记系统/1.png","hash":"cbbc86c9fa5786c5d9f3a2572f2404cd2e28343c","modified":1695134749835},{"_id":"source/image/k8s部署云笔记系统/4.png","hash":"ad4e697fc59a97823ecea4b0b1518e1b47ac554f","modified":1695135164081},{"_id":"source/image/云笔记系统扩容/backup.png","hash":"5f24217b2cedf48df437fd12b07a40714b3aef42","modified":1695193380118},{"_id":"source/image/云笔记系统扩容/add-labels.png","hash":"bda66f4607328559c6c30ffdb8c72a609440b6d2","modified":1695193699809},{"_id":"source/image/云笔记系统扩容/delete-pod.png","hash":"555dd5ad746957138bf6322fad5a9c016b1c6c8b","modified":1695193512011},{"_id":"source/image/云笔记系统扩容/login.png","hash":"a004fc668d822d77284e1cceeee3c06e09501eec","modified":1695193348520},{"_id":"source/image/云笔记系统扩容/expand.png","hash":"b7b091f13ebee50e6be59d2d1c49cb69c459a87d","modified":1695194083229},{"_id":"source/image/云笔记系统扩容/pod-after-deploy.png","hash":"ddb7e4b717be6f48c7f7090c34b5d9fec746589d","modified":1695193845583},{"_id":"source/image/云笔记系统扩容/pod-after-deleted.png","hash":"39cda3ef81cc34d9080163e85134bcad21d70521","modified":1695193632554},{"_id":"source/image/云笔记系统扩容/pod-node.png","hash":"47f61d747d459f2e0a4728c77e01c6f14f287436","modified":1695193233122},{"_id":"source/image/云笔记系统扩容/setting.png","hash":"4ca95d8e457eba8f21ffe74743f00d479623f20f","modified":1695194013834},{"_id":"source/image/云笔记系统扩容/vmware.png","hash":"08bd99db55ee3786a77142de854b7d046410e100","modified":1695193301246},{"_id":"source/image/云笔记系统扩容/shutdown.png","hash":"e320600cd94d80e5b89012afdc90a4a8e2668d5d","modified":1695193961828},{"_id":"source/image/云笔记系统扩容/pod.png","hash":"77a844b176d7492e31868b9ba95bb9e468997de8","modified":1695193123630},{"_id":"themes/butterfly/source/img/top_img/妮露.jpg","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1695221635930},{"_id":"themes/butterfly/source/img/top_img/妮露1.jpg","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1695221784023},{"_id":"source/image/k8s部署云笔记系统/6.png","hash":"7608498f2f5dede16990a0643e242280e193f9c1","modified":1695135238989},{"_id":"source/image/云笔记系统扩容/6.png","hash":"7608498f2f5dede16990a0643e242280e193f9c1","modified":1695135238989},{"_id":"source/image/云笔记系统扩容/xftp.png","hash":"e3cb8d796d3576397b91f6168a106dcc215b85d6","modified":1695193439539},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1693301015683},{"_id":"themes/butterfly/README.md","hash":"b5d6e7271b88d1a63755386442663af03e36a428","modified":1693301015683},{"_id":"themes/butterfly/package.json","hash":"1646604798f745ef068852772eb22239985ba731","modified":1693301015694},{"_id":"themes/butterfly/README_CN.md","hash":"86569b94949392e9b981608433495f0941d20b0c","modified":1693301015683},{"_id":"themes/butterfly/languages/default.yml","hash":"4025c0ba440eb24705dd0293ca9ca84efb3105cc","modified":1693301015684},{"_id":"themes/butterfly/_config.yml","hash":"459517785a7161e07c333bfe2900243b6287f905","modified":1693301015683},{"_id":"themes/butterfly/languages/en.yml","hash":"4e9cdb7a3570929bcf082de7a4eac49140dddc73","modified":1693301015684},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"ee01e068f12dc33adfae5733824ea1255deb5ca6","modified":1693301015684},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"7dd849c3ba34986c57c764d9e36150b4bfffd2e9","modified":1693301015684},{"_id":"themes/butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1693301015684},{"_id":"themes/butterfly/plugins.yml","hash":"d0e179ae31cdc62037062432b0ee7a9008155a73","modified":1693301015694},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1693301015694},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1693301015684},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1693301015694},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1693301015694},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1693301015683},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1693301015683},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1693301015683},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1693301015684},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"aca0ec7ef69b21d1f242c62fed389468a0f0e1a2","modified":1693301015684},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1693301015683},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"dd9fde431add984330e3178e06a8d74705e7340e","modified":1693301015684},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"fc468a93a64c7a3e408fbac921c9f5a5a8f32027","modified":1693301015682},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"7fa9ae4b70b87fc97e992dde5944681f92b59bea","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"9f0e9e039f304439007460fa0a7c8ac18e0ffd37","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"d15124c488273ea0801a042888feadc9261d0b2f","modified":1693301015687},{"_id":"themes/butterfly/source/css/index.styl","hash":"755490867fd8afe47d5cce24faea2ca172b0c4dd","modified":1693301015701},{"_id":"themes/butterfly/source/css/var.styl","hash":"30abbb8eed880d51f61f336064d93abd709e0115","modified":1693301015701},{"_id":"themes/butterfly/source/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1693301015702},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"b8e05ea08ef5548c37d8022e76403c77d62d5d1a","modified":1695209464605},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1693301015701},{"_id":"themes/butterfly/source/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1693301015703},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1693301015702},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1693301015701},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1693301015702},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1693301015694},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"21fb5aabe043486d095c4c8cce361ed85ba88a26","modified":1693301015694},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1693301015694},{"_id":"themes/butterfly/scripts/events/init.js","hash":"428b94c7b9e83f7ea36227dee66bfe3c23aee4a8","modified":1693301015694},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1693301015695},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1693301015695},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1693301015695},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"8d25f47434deae870bbffd07efe528a40363ab4d","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"9ea86bd7a3c3fca3324f70b1cd4d9e42f9efb08d","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"4238e06ff448ff2ee717cd4c874f37f04d35da06","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"ce5d5a3d07b0d76ac5e96e5f9e5783f4b601b6be","modified":1693301015695},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1693301015695},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"950b3dbac0b21717458a8d1769cbfc454d0eff54","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"ea679dfe12d0e2290113b4a9d00663ce7a5ee5ad","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1693301015696},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1693301015696},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1693301015684},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"75e7a524af64fbaaaf7b05a1b1922bf6940d7afe","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"67e1c3b48e4ca7ee0b2c76d3ca7476b9883cf105","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"a03b3ddc06e7aa9fd07eea0d5f97c8d5addd2315","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"944d6e9dd50df3395f3a2c7ad9db667d50dea4ed","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1693301015685},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"f61659aa457d1a2d1baa3a13157996cfac4d6609","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"5de9a82032cdad1db3b868b797460921cd775fc2","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"9e8c5788602b29a527ef35fe8a20076a5fa969bd","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"6ab4e301c92586505d6cddce1b3ad23b7c79010d","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"1ed873db25eec869beebb6873f04e19f0b0f4134","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1693301015686},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"f9ce83978b217a71a2eb8761dc14b09866faa3f4","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"9621991359e22b14049346f1cf87bdedc94edf5a","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1693301015687},{"_id":"themes/butterfly/source/img/wechat.JPG","hash":"6f338f11da8b9f568bde4a9255b4eefe29343c22","modified":1693472433708},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"cde142861edfc7aab435b8a0ebb84d9ba450fb5b","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"8044b9c18b34b019ffe26b7383e7e80356b5e4b5","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"03c6afabbf1ac729c7fb21c7ec06da0190b0fdc7","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"7834bf7c711e739fd33cfcd0b53d151013b3d449","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"eceb4420a64c720f0d2741e89d6229bbb3d87353","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1693301015693},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1693301015694},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"010e3d548ababca2280c4fc4168d9a4a1ee4f536","modified":1693301015694},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"e0de61a059b5e6c7b8ebc7149b4650bdcd69af5e","modified":1693301015697},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"51868d861c94a9f1ad7c0dbd66d2f475c5d4ea62","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"57a19eb0c418d92a88b143f56ccb8cd60e6d7ad0","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1693301015697},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"57adf29a3e36e4ea84384e36c034eb294dffb208","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"83a7a70eb0532ea9c4267939fe484af915fca01e","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"8cd2aaa32cd68cd1908c9001444a811c3d0f9267","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"fc9424d9c5def2201ec1d04dc79d0beedc1d2175","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1693301015698},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bbc884d6b2158a833b77a1bbc07248e17874b22e","modified":1693301015699},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1693301015694},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1693301015699},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"5556c9bf4f53a90cb9b4945cd76a8849bd67f3f3","modified":1693301015699},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"e4f948b0d4eb5483b2b360e56cbfe3359751b438","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"4e320e16d49bc18085045937681f7331a1e243ca","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"b3ea08d9460122751144a3ca835e009a460d6ad3","modified":1693301015699},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1693301015700},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"c481d1f689a4e6d7ee492a03751bda47a30225ce","modified":1693301015699},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"649a054e73278b6724bd4dd9b94724791ec5c928","modified":1693301015700},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"20a3134e1302b62bfc881f4ec43f398267111f22","modified":1693301015700},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"a86e4e9198b225b4b73a7a45f04b86cbbed0d231","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"81ad85acf0e0fe7f9ee23c16a700e7154574d5dd","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1693301015700},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1693301015700},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1693301015702},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1693301015701},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1693301015701},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1693301015702},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1693301015700},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"ed6906b7c6aa7046bbad95dfdda9211997be7099","modified":1693301015687},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f58f1648d2d71311bafca4833f20b605bb5f18c8","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"5f86add36eeffbed61d11f08972a13697b4d9437","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"56c028ba0ea8fac19f0125114d765dfc56ce2b48","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"ddce8352b371a1fb426bdb6c33f587eb37a69647","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"0344477a2cf38698318ead2681c63ac12f01586e","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"d02f3cc9e6183e7d05c7e90e9ae1dee5ce21f297","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1693301015688},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"2fb098a7aa45010a8cd212dc0bd5308c6e7c63e3","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"9b57a8e13de8fc51a5f550854e47164fd8ac1be8","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"618e1b7f9204049b07beb9e1363c844a78a9ace3","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"dd61eca6e9a45f63e09bdefba89fe285a81ba096","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"5d5d8a0a3a7690d6d01e3feb91c2a36a5cd651b1","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"e39a9c37adf4cb15a2ba3b2cc65542ffea88650d","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"6e17b2cea503eabeb328835038812cfa95f15871","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"0704efed9079c867ab5f7bee7381a6c869154c73","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"9ef303da16d180619da18b146ddb9bc35f66bdbf","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"2fc5627eb63118c83df9422b47c801822e28df98","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"5127bc550a2edb1ab9f45416e1964c76e8201544","modified":1693301015689},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"35ae7980f658a349c5956c5699efd435b604b836","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"598790433e3c9be28b0063bff08d257acd0abf75","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"4d78f6266d0870c06c10eaf47c951bd4d9a7732e","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"0a1b8fe95623b095eb7ede3f30ca327684d1e613","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"d0ce1891b042dcc2c93cacc866e38721b94aa4c4","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"8c0d9a45bd2d83cc6d0e7bbfe172a09ff33c0178","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"00960bf483318e76ee4e1d90456f0e934959a8c5","modified":1695269671591},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"fc072ac839401174b5d3cf9acd3b694246c23a55","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"0330e3063ccf0ce40e4828b8d4fbef62362e8195","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"4fe8faf77b8420fc031ae1b54f78b2ece9fcc07e","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"aa6061183a32472cd1882fce445a5049108a984b","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"b7b2aa5be4112065d5066c0f066f5f58721153bf","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"44991d67abb81784c5cdb4337b2b9798fc4361e1","modified":1693301015691},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"2a8d02ed9303092e8816f6489a443e7388102470","modified":1693301015690},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"9c3c109a12d2b6916e8b4965cca12f521510ead9","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"1c3e101445c5571ba998ce293d3984319df1b3b0","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"a99a41334387ee9a46c6f8e8212331a29a10d159","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"5ebd5e8d39c9f77f5b2d983f6cd6802ccaf98746","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ae1ccd78926cc19399d396b237d5161d7cde44a8","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1693301015692},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1693301015692},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1693301015697},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1693301015697},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1693301015693},{"_id":"source/image/k8s部署云笔记系统/5.png","hash":"1432b61eb04256e0627913d0e3323eff178626b1","modified":1695135226787},{"_id":"source/image/云笔记系统扩容/backup-desktop.png","hash":"e6ec39385bcd11c4db8a3599509e3fc40f0bce83","modified":1695193567047},{"_id":"source/image/k8s部署云笔记系统/2.png","hash":"eae90eb1b195c84430fe54a09819862bdd352a2f","modified":1695135048964},{"_id":"themes/butterfly/source/img/alipay.JPG","hash":"242f28ac6b31ce2fae669f9b357f88b19a1a755a","modified":1693472403927},{"_id":"source/image/k8s部署云笔记系统/3.png","hash":"85cfb5ad615d808491052523c665dd38c152b148","modified":1695135130751},{"_id":"themes/butterfly/source/js/Valine.min.js","hash":"c19fcca376470c5049873475548131c31e8a950b","modified":1695225699254},{"_id":"themes/butterfly/source/img/background/樱花2.jpg","hash":"858a926496f17529430ef9c1b56aa3a25abb97af","modified":1695213776091},{"_id":"themes/butterfly/source/img/assets/头像.JPG","hash":"2982b004f5f53918d2a6083056455bf3a479d60d","modified":1667716281000},{"_id":"themes/butterfly/source/img/background/樱花1.jpg","hash":"ffa38044c2b06e88c45468340c916e862b599b51","modified":1695213803321},{"_id":"source/image/云笔记系统扩容/pod-deploy.png","hash":"5d7087ce3dfa3e1c38cee56e75eef71845787de5","modified":1695193780237},{"_id":"themes/butterfly/source/img/cover/胡桃.JPG","hash":"2923059bece9c61f6a1d7437af94ad143a75f9c9","modified":1693569329000},{"_id":"themes/butterfly/source/img/background/灯笼.jpg","hash":"444fa74609d43a3d3674ac5f92b6c5a244638acb","modified":1695213760958},{"_id":"source/image/k8s部署云笔记系统/可莉.png","hash":"19e482e216be26cf376cce9c2f26f95507cc8963","modified":1690225383971},{"_id":"themes/butterfly/source/img/top_img/久岐忍.jpg","hash":"e246c0e1a6d3e4bbccb10d94a4d56ed4d6193de0","modified":1683610693958},{"_id":"themes/butterfly/source/img/cover/久岐忍.jpg","hash":"0f6323c46ff2e62fb3f42717be15cd745bc0dc0c","modified":1695214946656},{"_id":"themes/butterfly/source/img/top_img/久岐忍3.jpg","hash":"b2ed448c8024d391ad49e9f7853b62dc42db143b","modified":1695215358520},{"_id":"themes/butterfly/source/img/assets/雷电将军.jpg","hash":"819f25810c1b679ad83a4d3ecf9ef6152627be57","modified":1666192344847},{"_id":"public/search.xml","hash":"4bc8a1b73bd09ffad98e315cc19915d83351cf15","modified":1695401136093},{"_id":"public/about/index.html","hash":"297823051381741be4392e33ea8be13c9b320c3c","modified":1695401136093},{"_id":"public/categories/index.html","hash":"201f2800f62744a52d6098bd7311f26dea8896d3","modified":1695401136093},{"_id":"public/music/index.html","hash":"416f79faa86ccb4ec2d0264934b165807532f434","modified":1695401136093},{"_id":"public/movies/index.html","hash":"3fe989a8c37a4d228972ddc1ba15535cd8248253","modified":1695401136093},{"_id":"public/pictures/index.html","hash":"d6b2f7888688dbaf65c453d5aedf115e9eec4926","modified":1695401136093},{"_id":"public/link/index.html","hash":"ad615df4dd5f23fc1e7fdcf4713d2b011f7db8c1","modified":1695401136093},{"_id":"public/tags/index.html","hash":"65eeae308f9a6b5dd306d777d39689efde4bc4b1","modified":1695401136093},{"_id":"public/posts/36313.html","hash":"5b3a8e3b71b869bbb30bad99f727b04d7c13eda2","modified":1695401136093},{"_id":"public/posts/16330.html","hash":"4c0630d87263b897b115cba45692915bd132f255","modified":1695401136093},{"_id":"public/posts/16107.html","hash":"1ae89fba5ba04f2374757622e96490fa1817f70a","modified":1695401136093},{"_id":"public/posts/63534.html","hash":"c16fd712ac95c9fe821ac93689327a7a62756bd5","modified":1695401136093},{"_id":"public/archives/index.html","hash":"ed15176f48aed03d0fe2f9b5fb6a1c9d2b8c7941","modified":1695401136093},{"_id":"public/archives/2018/index.html","hash":"ac5867babe2441f17151ae2d98697139104b9950","modified":1695401136093},{"_id":"public/archives/2018/01/index.html","hash":"b6caef429ef82422955a37d10e00ec2c910b7f3a","modified":1695401136093},{"_id":"public/archives/2023/index.html","hash":"4df815e4c0024fb308111869ecd3a46bcc3c2f34","modified":1695401136093},{"_id":"public/categories/Kubernetes/index.html","hash":"58619bd94d6478cafde029ec3910c1c2c7659043","modified":1695401136093},{"_id":"public/categories/hexo/index.html","hash":"a8ed97fd467768555c7d5598f0072a6262dcdab8","modified":1695401136093},{"_id":"public/archives/2023/09/index.html","hash":"f0503239c41c18bac84491bd5ad8e7dfa7d3e86c","modified":1695401136093},{"_id":"public/index.html","hash":"32c89e0ae96233522222b3fe8af39b467351cabd","modified":1695401136093},{"_id":"public/tags/hexo/index.html","hash":"21cfd220aed371b91981b11d92708ddec461c86f","modified":1695401136093},{"_id":"public/tags/教程/index.html","hash":"b81ab6942c2156ffad20f9bfafdcdeb18585325a","modified":1695401136093},{"_id":"public/tags/k8s/index.html","hash":"e75c75eba8d0d7bd8f50dbaa49e2993a7663459b","modified":1695401136093},{"_id":"public/tags/Kubernetes/index.html","hash":"e3e8aca441c006743e1fb4093586863ef7d3e9ee","modified":1695401136093},{"_id":"public/tags/测试/index.html","hash":"7872f1a79152deb825eb466c151c92a25b6468bd","modified":1695401136093},{"_id":"public/categories/测试类/index.html","hash":"ff79cbbde366eda4acf4ead4e2a9332e158fe120","modified":1695401136093},{"_id":"public/img/top_img/妮露1.jpg","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1695401136093},{"_id":"public/img/top_img/妮露.jpg","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/1.png","hash":"cbbc86c9fa5786c5d9f3a2572f2404cd2e28343c","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/4.png","hash":"ad4e697fc59a97823ecea4b0b1518e1b47ac554f","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/backup.png","hash":"5f24217b2cedf48df437fd12b07a40714b3aef42","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/delete-pod.png","hash":"555dd5ad746957138bf6322fad5a9c016b1c6c8b","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/add-labels.png","hash":"bda66f4607328559c6c30ffdb8c72a609440b6d2","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/expand.png","hash":"b7b091f13ebee50e6be59d2d1c49cb69c459a87d","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/login.png","hash":"a004fc668d822d77284e1cceeee3c06e09501eec","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/pod-after-deploy.png","hash":"ddb7e4b717be6f48c7f7090c34b5d9fec746589d","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/pod-after-deleted.png","hash":"39cda3ef81cc34d9080163e85134bcad21d70521","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/pod-node.png","hash":"47f61d747d459f2e0a4728c77e01c6f14f287436","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/setting.png","hash":"4ca95d8e457eba8f21ffe74743f00d479623f20f","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/shutdown.png","hash":"e320600cd94d80e5b89012afdc90a4a8e2668d5d","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/vmware.png","hash":"08bd99db55ee3786a77142de854b7d046410e100","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/pod.png","hash":"77a844b176d7492e31868b9ba95bb9e468997de8","modified":1695401136093},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1695401136093},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1695401136093},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1695401136093},{"_id":"public/img/wechat.JPG","hash":"6f338f11da8b9f568bde4a9255b4eefe29343c22","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/6.png","hash":"7608498f2f5dede16990a0643e242280e193f9c1","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/6.png","hash":"7608498f2f5dede16990a0643e242280e193f9c1","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/xftp.png","hash":"e3cb8d796d3576397b91f6168a106dcc215b85d6","modified":1695401136093},{"_id":"public/img/alipay.JPG","hash":"242f28ac6b31ce2fae669f9b357f88b19a1a755a","modified":1695401136093},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1695401136093},{"_id":"public/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1695401136093},{"_id":"public/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1695401136093},{"_id":"public/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1695401136093},{"_id":"public/css/index.css","hash":"7ec09b47c52077cb7a30b4c07512373d5223cdb9","modified":1695401136093},{"_id":"public/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1695401136093},{"_id":"public/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1695401136093},{"_id":"public/js/Valine.min.js","hash":"c19fcca376470c5049873475548131c31e8a950b","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/2.png","hash":"eae90eb1b195c84430fe54a09819862bdd352a2f","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/5.png","hash":"1432b61eb04256e0627913d0e3323eff178626b1","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/backup-desktop.png","hash":"e6ec39385bcd11c4db8a3599509e3fc40f0bce83","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/3.png","hash":"85cfb5ad615d808491052523c665dd38c152b148","modified":1695401136093},{"_id":"public/img/background/樱花2.jpg","hash":"858a926496f17529430ef9c1b56aa3a25abb97af","modified":1695401136093},{"_id":"public/img/assets/头像.JPG","hash":"2982b004f5f53918d2a6083056455bf3a479d60d","modified":1695401136093},{"_id":"public/img/background/樱花1.jpg","hash":"ffa38044c2b06e88c45468340c916e862b599b51","modified":1695401136093},{"_id":"public/image/云笔记系统扩容/pod-deploy.png","hash":"5d7087ce3dfa3e1c38cee56e75eef71845787de5","modified":1695401136093},{"_id":"public/img/cover/胡桃.JPG","hash":"2923059bece9c61f6a1d7437af94ad143a75f9c9","modified":1695401136093},{"_id":"public/img/background/灯笼.jpg","hash":"444fa74609d43a3d3674ac5f92b6c5a244638acb","modified":1695401136093},{"_id":"public/img/top_img/久岐忍.jpg","hash":"e246c0e1a6d3e4bbccb10d94a4d56ed4d6193de0","modified":1695401136093},{"_id":"public/image/k8s部署云笔记系统/可莉.png","hash":"19e482e216be26cf376cce9c2f26f95507cc8963","modified":1695401136093},{"_id":"public/img/cover/久岐忍.jpg","hash":"0f6323c46ff2e62fb3f42717be15cd745bc0dc0c","modified":1695401136093},{"_id":"public/img/top_img/久岐忍3.jpg","hash":"b2ed448c8024d391ad49e9f7853b62dc42db143b","modified":1695401136093},{"_id":"public/img/assets/雷电将军.jpg","hash":"819f25810c1b679ad83a4d3ecf9ef6152627be57","modified":1695401136093}],"Category":[{"name":"hexo","_id":"clmuu294f00038vgn1806enux"},{"name":"Kubernetes","_id":"clmuu294i000g8vgn167h4n0m"},{"name":"测试类","_id":"clmuu294i000j8vgna2xdfxy2"}],"Data":[{"_id":"link","data":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}],"Page":[{"title":"about","date":"2023-08-31T11:46:34.000Z","type":"about","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2023-08-31 19:46:34\ntype: \"about\"\n---\n","updated":"2023-08-31T11:46:47.429Z","path":"about/index.html","comments":1,"layout":"page","_id":"clmuu294c00008vgndhhch622","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"categories","date":"2018-01-04T16:00:00.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2018-01-05 00:00:00\ntype: \"categories\"\n---\n","updated":"2023-08-31T11:44:33.118Z","path":"categories/index.html","comments":1,"layout":"page","_id":"clmuu294f00028vgn8mx6d0k4","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"music","date":"2023-08-31T11:48:40.000Z","type":"music","_content":"","source":"music/index.md","raw":"---\ntitle: music\ndate: 2023-08-31 19:48:40\ntype: \"music\"\n---\n","updated":"2023-08-31T11:49:46.718Z","path":"music/index.html","comments":1,"layout":"page","_id":"clmuu294g00058vgne14khkm5","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"movies","date":"2023-08-31T11:48:52.000Z","type":"movies","_content":"","source":"movies/index.md","raw":"---\ntitle: movies\ndate: 2023-08-31 19:48:52\ntype: \"movies\"\n---\n","updated":"2023-08-31T11:49:46.713Z","path":"movies/index.html","comments":1,"layout":"page","_id":"clmuu294g00068vgnacan0x4g","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"pictures","date":"2023-09-19T15:55:05.000Z","_content":"","source":"pictures/index.md","raw":"---\ntitle: pictures\ndate: 2023-09-19 23:55:05\n---\n","updated":"2023-09-19T15:55:05.212Z","path":"pictures/index.html","comments":1,"layout":"page","_id":"clmuu294g00078vgn39r25tcy","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"link","date":"2023-08-31T11:44:43.000Z","type":"link","_content":"","source":"link/index.md","raw":"---\ntitle: link\ndate: 2023-08-31 19:44:43\ntype: \"link\"\n---\n","updated":"2023-08-31T11:45:01.378Z","path":"link/index.html","comments":1,"layout":"page","_id":"clmuu294g00098vgn9qvegi2g","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""},{"title":"tags","date":"2018-01-04T16:00:00.000Z","type":"tags","orderby":"random","order":1,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-01-05 00:00:00\ntype: \"tags\"\norderby: random\norder: 1\n---\n","updated":"2023-09-13T16:03:00.990Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clmuu294g000a8vgn50fzcc5c","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"/img/cover/久岐忍.jpg","cover_type":"img","excerpt":"","more":""}],"Post":[{"title":"Hello World","abbrlink":16107,"date":"2018-01-04T16:00:00.000Z","updated":"2023-09-13T16:10:00.000Z","keywords":null,"description":null,"top_img":null,"comments":1,"cover":"/img/cover/久岐忍.jpg","toc":null,"toc_number":null,"toc_style_simple":null,"copyright":null,"copyright_author":null,"copyright_author_href":null,"copyright_url":null,"copyright_info":null,"mathjax":null,"katex":null,"aplayer":null,"highlight_shrink":null,"aside":null,"abcjs":null,"_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ntags:\n  - hexo\n  - 教程\ncategories:\n  - hexo\nabbrlink: 16107\ndate: 2018-01-05 00:00:00\nupdated: 2023-09-14 00:10:00\nkeywords:\ndescription:\ntop_img:\ncomments:\ncover:\ntoc:\ntoc_number:\ntoc_style_simple:\ncopyright:\ncopyright_author:\ncopyright_author_href:\ncopyright_url:\ncopyright_info:\nmathjax:\nkatex:\naplayer:\nhighlight_shrink:\naside:\nabcjs:\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"layout":"post","photos":[],"link":"","_id":"clmuu294d00018vgn87jucu28","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover_type":"img","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"k8s部署云笔记系统","description":"在k8s服务器上部署云笔记系统","top_img":"../image/k8s部署云笔记系统/可莉.png","abbrlink":16330,"date":"2023-09-19T14:35:00.000Z","updated":"2023-09-20T05:35:00.000Z","keywords":null,"comments":1,"cover":"/img/cover/久岐忍.jpg","toc":null,"toc_number":null,"toc_style_simple":null,"copyright":null,"copyright_author":null,"copyright_author_href":null,"copyright_url":null,"copyright_info":null,"mathjax":null,"katex":null,"aplayer":null,"highlight_shrink":null,"aside":null,"abcjs":null,"_content":"\n> 起因是导师之前让两个研一的学弟学妹写了个前后端的云笔记系统，然后后面让我部署到服务器中，因此记录一下。\n\n## 创建namespace\n\n```kubernetes helm\n# 创建namespace\nkubectl create namespace note\n```\n\n## 1. 部署MySQL\n\n创建mysql文件夹\n\n```shell\nsudo mkdir -p /home/mysql/data\n```\n\n### 1.1 挂载数据卷\n\nnote-mysql-pvc.yaml\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n\tstorage: 1Gi\n  accessModes:\n\t- ReadWriteOnce\n  hostPath:\n\tpath: /home/mysql/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n\t- ReadWriteOnce\n  resources:\n\trequests:\n\t  storage: 1Gi\n  storageClassName: \"\"\n\tvolumeName: note-mysql-pv\n```\n\n部署\n\n```kubernetes helm\nkubectl create -f note-mysql-pvc.yaml -n note\n```\n\n查看是否部署成功：\n\n![mysql是否部署成功](../image/k8s部署云笔记系统/1.png)\n\n### 1.2 部署mysql\n\nnote-mysql.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mysql-deployment\nspec:\n  replicas: 1\n  selector:\n\tmatchLabels:\n\t  app: note-mysql-pod\n  template:\n\tmetadata:\n\t  labels:\n\t\tapp: note-mysql-pod\n\tspec:\n\t  containers:\n\t\t- name: note-mysql\n\t\t  image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0\n\t\t  imagePullPolicy: IfNotPresent\n\t\t  env:\n\t\t\t- name: MYSQL_ROOT_PASSWORD\n\t\t\t  value: dfa6f1b032ee42ed95d12647225f2ff4\n\t\t  ports:\n\t\t\t- containerPort: 3306\n\t\t  volumeMounts:\n\t\t\t- name: note-mysql-persistent-storage\n\t\t\t  mountPath: /var/lib/mysql\n\tvolumes:\n\t  - name: note-mysql-persistent-storage\n\t\tpersistentVolumeClaim:\n\t\t  claimName: note-mysql-pvc # 使用之前创建的持久卷声明\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mysql-service\nspec:\n  selector:\n\tapp: note-mysql-pod\n  type: NodePort # service类型\n  ports:\n  - port: 3306\n\tnodePort: 30006 # 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配\n\ttargetPort: 3306\n```\n\n部署：\n\n```kubernetes helm\nkubectl create -f note-mysql.yaml -n note\n```\n\n## 2. 部署redis\n\nnote-redis.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-redis-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-redis-pod\n  template:\n    metadata:\n      labels:\n        app: note-redis-pod\n    spec:\n      containers:\n        - name: note-redis\n          image: redis:latest\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: REDIS_PASSWORD\n              value: adcc64a4a9b04324914626590fb52a1a\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-redis-service\nspec:\n  selector:\n    app: note-redis-pod\n  type: NodePort # service类型\n  ports:\n  - port: 6379\n    nodePort: 30079 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 6379\n```\n\n部署：\n\n```kubernetes helm\nkubectl create -f note-redis.yaml -n note\n```\n\n## 3. 部署mongodb\n\n创建mongodb文件夹\n\n```shell\nsudo mkdir -p /home/mongodb/data\n```\n\n### 3.1 挂载数据卷\n\nnote-mongodb-pvc.yaml\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 1Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n使用\n\n```kubernetes helm\nkubectl create -f note-mongodb-pvc.yaml -n note\n```\n\n查看是否装好：\n\n![mongodb-pvc](../image/k8s部署云笔记系统/2.png)\n\n### 3.2 部署\n\nnote-mongodb.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mongodb-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mongodb-pod\n  template:\n    metadata:\n      labels:\n        app: note-mongodb-pod\n    spec:\n      containers:\n        - name: note-mongodb\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 27017\n          env:\n            - name: MONGO_INITDB_ROOT_USERNAME\n              value: admin\n            - name: MONGO_INITDB_ROOT_PASSWORD\n              value: 5c8b18289f7848e9b0af98e81562649d\n          volumeMounts:\n            - name: note-mongodb-persistent-storage\n              mountPath: /data/db\n      volumes:\n        - name: note-mongodb-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mongodb-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mongodb-service\nspec:\n  selector:\n    app: note-mongodb-pod\n  type: NodePort # service类型\n  ports:\n  - port: 27017\n    nodePort: 30017 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 27017\n```\n\n```kubernetes helm\nkubectl create -f note-mongodb.yaml -n note\n```\n\n检查部署情况\n\n![mongodb](../image/k8s部署云笔记系统/3.png)\n\n## 4. 部署服务bert_flask\n\nbert_flask.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: bert-flask-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: bert-flask-pod\n  template:\n    metadata:\n      labels:\n        app: bert-flask-pod\n    spec:\n      containers:\n      - name: bert-flask\n        image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/bert_flask:v1.3.0\n        imagePullPolicy: IfNotPresent # Always\n        ports:\n        - containerPort: 5000\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: bert-flask-service\nspec:\n  selector:\n    app: bert-flask-pod\n  type: NodePort # service类型\n  ports:\n  - port: 5000\n    nodePort: 30050 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 5000\n```\n\n```kubernetes helm\nkubectl create -f bert_flask.yaml -n note\n```\n\n检查部署情况\n![bert_flask](../image/k8s部署云笔记系统/4.png)\n\n## 5. 部署服务note_cloud\n\n### 5.1 配置ConfigMap\n\n   新建application-prod.yml\n\n```yaml\nserver:\n  port: 8080\n  servlet:\n    context-path: /api\nspring:\n  datasource:\n    url: jdbc:mysql://note-mysql-service:3306/db_note\n    username: root\n    password: dfa6f1b032ee42ed95d12647225f2ff4\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    type: com.alibaba.druid.pool.DruidDataSource\n  redis:\n    host: note-redis-service\n    port: 6379\n    password: adcc64a4a9b04324914626590fb52a1a\n    lettuce:\n      pool:\n        max-active: 10\n        max-idle: 10\n        min-idle: 1\n        time-between-eviction-runs: 10s\n    jackson:\n      default-property-inclusion: non_null # JSON处理时忽略非空字段\n  data:\n    mongodb:\n      uri: mongodb://note-user:c88c1b8c2ed94010-8372efbc0879bdcb@note-mongodb-service:27017/mongodb_note\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\njwt:\n  base64-encoded-secret-key: lab_of_njust_cloud_computing # jwt的签名密码\nbert-base-chinese-service:\n  host: bert-flask-service\n  port: 5000\n```\n\n```kubernetes helm\nkubectl create configmap note-cloud-config -n note --fromfile=application-prod.yml\n```\n\n   查看部署状态\n   ![部署效果](../image/k8s部署云笔记系统/4.png)\n\n### 5.2 部署服务\n\nnote-cloud.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-cloud-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-cloud-pod\n  template:\n    metadata:\n      labels:\n        app: note-cloud-pod\n    spec:\n      containers:\n      - name: note-cloud\n        image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_cloud:v1.3.0\n        imagePullPolicy: IfNotPresent # Always\n        ports:\n        - containerPort: 8080\n        volumeMounts:\n        - name: config-volume\n          mountPath: /app/config # 配置文件将挂载到容器的/app/config目录\n      volumes:\n      - name: config-volume\n        configMap:\n          name: note-cloud-config # 引用之前创建的 ConfigMap\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-cloud-service\nspec:\n  selector:\n    app: note-cloud-pod\n  type: NodePort # service类型\n  ports:\n  - port: 8080\n    nodePort: 30080 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 8080\n```\n\n```kubernetes helm\nkubectl create -f note-cloud.yaml -n note\n```\n\n查看日志\n\n```kubernetes helm\nkubectl get pod -n note\nkubectl logs -f note-cloud-deployment-6687c5cb49-vc7kl -n note\n```\n\n## 6. 部署前端\n\nnote-nginx.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-nginx-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-nginx-pod\n  template:\n    metadata:\n      labels:\n        app: note-nginx-pod\n    spec:\n      containers:\n        - name: note-nginx\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-nginx:v2.2.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-nginx-service\nspec:\n  selector:\n    app: note-nginx-pod\n  type: NodePort # service类型\n  ports:\n  - port: 80\n    nodePort: 30088 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 80\n```\n\n```kubernetes helm\nkubectl create -f note-nginx.yaml -n note\n```\n\n## 最终部署pod查看\n\n![pod](../image/k8s部署云笔记系统/5.png)\n\n访问（连校园网，关梯子）：\n\nhttp://192.10.84.209:33395/cloudNote/\n账号：姓名小写拼音\n密码：123456\n\n\n最终效果：\n![6](../image/k8s部署云笔记系统/6.png)\n","source":"_posts/k8s部署云笔记系统.md","raw":"---\ntitle: k8s部署云笔记系统\ntags:\n  - k8s\n  - Kubernetes\n  - 教程\ncategories:\n  - Kubernetes\ndescription: 在k8s服务器上部署云笔记系统\ntop_img: ../image/k8s部署云笔记系统/可莉.png\nabbrlink: 16330\ndate: 2023-09-19 22:35:00\nupdated: 2023-09-20 13:35:00\nkeywords:\ncomments:\ncover:\ntoc:\ntoc_number:\ntoc_style_simple:\ncopyright:\ncopyright_author:\ncopyright_author_href:\ncopyright_url:\ncopyright_info:\nmathjax:\nkatex:\naplayer:\nhighlight_shrink:\naside:\nabcjs:\n---\n\n> 起因是导师之前让两个研一的学弟学妹写了个前后端的云笔记系统，然后后面让我部署到服务器中，因此记录一下。\n\n## 创建namespace\n\n```kubernetes helm\n# 创建namespace\nkubectl create namespace note\n```\n\n## 1. 部署MySQL\n\n创建mysql文件夹\n\n```shell\nsudo mkdir -p /home/mysql/data\n```\n\n### 1.1 挂载数据卷\n\nnote-mysql-pvc.yaml\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n\tstorage: 1Gi\n  accessModes:\n\t- ReadWriteOnce\n  hostPath:\n\tpath: /home/mysql/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n\t- ReadWriteOnce\n  resources:\n\trequests:\n\t  storage: 1Gi\n  storageClassName: \"\"\n\tvolumeName: note-mysql-pv\n```\n\n部署\n\n```kubernetes helm\nkubectl create -f note-mysql-pvc.yaml -n note\n```\n\n查看是否部署成功：\n\n![mysql是否部署成功](../image/k8s部署云笔记系统/1.png)\n\n### 1.2 部署mysql\n\nnote-mysql.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mysql-deployment\nspec:\n  replicas: 1\n  selector:\n\tmatchLabels:\n\t  app: note-mysql-pod\n  template:\n\tmetadata:\n\t  labels:\n\t\tapp: note-mysql-pod\n\tspec:\n\t  containers:\n\t\t- name: note-mysql\n\t\t  image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0\n\t\t  imagePullPolicy: IfNotPresent\n\t\t  env:\n\t\t\t- name: MYSQL_ROOT_PASSWORD\n\t\t\t  value: dfa6f1b032ee42ed95d12647225f2ff4\n\t\t  ports:\n\t\t\t- containerPort: 3306\n\t\t  volumeMounts:\n\t\t\t- name: note-mysql-persistent-storage\n\t\t\t  mountPath: /var/lib/mysql\n\tvolumes:\n\t  - name: note-mysql-persistent-storage\n\t\tpersistentVolumeClaim:\n\t\t  claimName: note-mysql-pvc # 使用之前创建的持久卷声明\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mysql-service\nspec:\n  selector:\n\tapp: note-mysql-pod\n  type: NodePort # service类型\n  ports:\n  - port: 3306\n\tnodePort: 30006 # 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配\n\ttargetPort: 3306\n```\n\n部署：\n\n```kubernetes helm\nkubectl create -f note-mysql.yaml -n note\n```\n\n## 2. 部署redis\n\nnote-redis.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-redis-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-redis-pod\n  template:\n    metadata:\n      labels:\n        app: note-redis-pod\n    spec:\n      containers:\n        - name: note-redis\n          image: redis:latest\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: REDIS_PASSWORD\n              value: adcc64a4a9b04324914626590fb52a1a\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-redis-service\nspec:\n  selector:\n    app: note-redis-pod\n  type: NodePort # service类型\n  ports:\n  - port: 6379\n    nodePort: 30079 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 6379\n```\n\n部署：\n\n```kubernetes helm\nkubectl create -f note-redis.yaml -n note\n```\n\n## 3. 部署mongodb\n\n创建mongodb文件夹\n\n```shell\nsudo mkdir -p /home/mongodb/data\n```\n\n### 3.1 挂载数据卷\n\nnote-mongodb-pvc.yaml\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 1Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n使用\n\n```kubernetes helm\nkubectl create -f note-mongodb-pvc.yaml -n note\n```\n\n查看是否装好：\n\n![mongodb-pvc](../image/k8s部署云笔记系统/2.png)\n\n### 3.2 部署\n\nnote-mongodb.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mongodb-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mongodb-pod\n  template:\n    metadata:\n      labels:\n        app: note-mongodb-pod\n    spec:\n      containers:\n        - name: note-mongodb\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 27017\n          env:\n            - name: MONGO_INITDB_ROOT_USERNAME\n              value: admin\n            - name: MONGO_INITDB_ROOT_PASSWORD\n              value: 5c8b18289f7848e9b0af98e81562649d\n          volumeMounts:\n            - name: note-mongodb-persistent-storage\n              mountPath: /data/db\n      volumes:\n        - name: note-mongodb-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mongodb-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mongodb-service\nspec:\n  selector:\n    app: note-mongodb-pod\n  type: NodePort # service类型\n  ports:\n  - port: 27017\n    nodePort: 30017 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 27017\n```\n\n```kubernetes helm\nkubectl create -f note-mongodb.yaml -n note\n```\n\n检查部署情况\n\n![mongodb](../image/k8s部署云笔记系统/3.png)\n\n## 4. 部署服务bert_flask\n\nbert_flask.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: bert-flask-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: bert-flask-pod\n  template:\n    metadata:\n      labels:\n        app: bert-flask-pod\n    spec:\n      containers:\n      - name: bert-flask\n        image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/bert_flask:v1.3.0\n        imagePullPolicy: IfNotPresent # Always\n        ports:\n        - containerPort: 5000\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: bert-flask-service\nspec:\n  selector:\n    app: bert-flask-pod\n  type: NodePort # service类型\n  ports:\n  - port: 5000\n    nodePort: 30050 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 5000\n```\n\n```kubernetes helm\nkubectl create -f bert_flask.yaml -n note\n```\n\n检查部署情况\n![bert_flask](../image/k8s部署云笔记系统/4.png)\n\n## 5. 部署服务note_cloud\n\n### 5.1 配置ConfigMap\n\n   新建application-prod.yml\n\n```yaml\nserver:\n  port: 8080\n  servlet:\n    context-path: /api\nspring:\n  datasource:\n    url: jdbc:mysql://note-mysql-service:3306/db_note\n    username: root\n    password: dfa6f1b032ee42ed95d12647225f2ff4\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    type: com.alibaba.druid.pool.DruidDataSource\n  redis:\n    host: note-redis-service\n    port: 6379\n    password: adcc64a4a9b04324914626590fb52a1a\n    lettuce:\n      pool:\n        max-active: 10\n        max-idle: 10\n        min-idle: 1\n        time-between-eviction-runs: 10s\n    jackson:\n      default-property-inclusion: non_null # JSON处理时忽略非空字段\n  data:\n    mongodb:\n      uri: mongodb://note-user:c88c1b8c2ed94010-8372efbc0879bdcb@note-mongodb-service:27017/mongodb_note\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\njwt:\n  base64-encoded-secret-key: lab_of_njust_cloud_computing # jwt的签名密码\nbert-base-chinese-service:\n  host: bert-flask-service\n  port: 5000\n```\n\n```kubernetes helm\nkubectl create configmap note-cloud-config -n note --fromfile=application-prod.yml\n```\n\n   查看部署状态\n   ![部署效果](../image/k8s部署云笔记系统/4.png)\n\n### 5.2 部署服务\n\nnote-cloud.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-cloud-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-cloud-pod\n  template:\n    metadata:\n      labels:\n        app: note-cloud-pod\n    spec:\n      containers:\n      - name: note-cloud\n        image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_cloud:v1.3.0\n        imagePullPolicy: IfNotPresent # Always\n        ports:\n        - containerPort: 8080\n        volumeMounts:\n        - name: config-volume\n          mountPath: /app/config # 配置文件将挂载到容器的/app/config目录\n      volumes:\n      - name: config-volume\n        configMap:\n          name: note-cloud-config # 引用之前创建的 ConfigMap\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-cloud-service\nspec:\n  selector:\n    app: note-cloud-pod\n  type: NodePort # service类型\n  ports:\n  - port: 8080\n    nodePort: 30080 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 8080\n```\n\n```kubernetes helm\nkubectl create -f note-cloud.yaml -n note\n```\n\n查看日志\n\n```kubernetes helm\nkubectl get pod -n note\nkubectl logs -f note-cloud-deployment-6687c5cb49-vc7kl -n note\n```\n\n## 6. 部署前端\n\nnote-nginx.yaml\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-nginx-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-nginx-pod\n  template:\n    metadata:\n      labels:\n        app: note-nginx-pod\n    spec:\n      containers:\n        - name: note-nginx\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-nginx:v2.2.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-nginx-service\nspec:\n  selector:\n    app: note-nginx-pod\n  type: NodePort # service类型\n  ports:\n  - port: 80\n    nodePort: 30088 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 80\n```\n\n```kubernetes helm\nkubectl create -f note-nginx.yaml -n note\n```\n\n## 最终部署pod查看\n\n![pod](../image/k8s部署云笔记系统/5.png)\n\n访问（连校园网，关梯子）：\n\nhttp://192.10.84.209:33395/cloudNote/\n账号：姓名小写拼音\n密码：123456\n\n\n最终效果：\n![6](../image/k8s部署云笔记系统/6.png)\n","slug":"k8s部署云笔记系统","published":1,"layout":"post","photos":[],"link":"","_id":"clmuu294h000e8vgncdd8ge1f","content":"<blockquote>\n<p>起因是导师之前让两个研一的学弟学妹写了个前后端的云笔记系统，然后后面让我部署到服务器中，因此记录一下。</p>\n</blockquote>\n<h2 id=\"创建namespace\"><a href=\"#创建namespace\" class=\"headerlink\" title=\"创建namespace\"></a>创建namespace</h2><figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 创建namespace</span><br><span class=\"line\">kubectl create namespace note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-部署MySQL\"><a href=\"#1-部署MySQL\" class=\"headerlink\" title=\"1. 部署MySQL\"></a>1. 部署MySQL</h2><p>创建mysql文件夹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /home/mysql/data</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-1-挂载数据卷\"><a href=\"#1-1-挂载数据卷\" class=\"headerlink\" title=\"1.1 挂载数据卷\"></a>1.1 挂载数据卷</h3><p>note-mysql-pvc.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">\t<span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">\t<span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">\t<span class=\"attr\">requests:</span></span><br><span class=\"line\">\t  <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t<span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p>部署</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mysql-pvc.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看是否部署成功：</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/1.png\" alt=\"mysql是否部署成功\"></p>\n<h3 id=\"1-2-部署mysql\"><a href=\"#1-2-部署mysql\" class=\"headerlink\" title=\"1.2 部署mysql\"></a>1.2 部署mysql</h3><p>note-mysql.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">\t<span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">\t  <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">\t<span class=\"attr\">metadata:</span></span><br><span class=\"line\">\t  <span class=\"attr\">labels:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">\t<span class=\"attr\">spec:</span></span><br><span class=\"line\">\t  <span class=\"attr\">containers:</span></span><br><span class=\"line\">\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">env:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\">\t\t\t  <span class=\"attr\">value:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">ports:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">\t\t\t  <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">\t\t<span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">claimName:</span> <span class=\"string\">note-mysql-pvc</span> <span class=\"comment\"># 使用之前创建的持久卷声明</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">\t<span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">\t<span class=\"attr\">nodePort:</span> <span class=\"number\">30006</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配</span></span><br><span class=\"line\">\t<span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<p>部署：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mysql.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-部署redis\"><a href=\"#2-部署redis\" class=\"headerlink\" title=\"2. 部署redis\"></a>2. 部署redis</h2><p>note-redis.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-redis-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-redis</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">redis:latest</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">REDIS_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">adcc64a4a9b04324914626590fb52a1a</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">6379</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-redis-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30079</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span></span><br></pre></td></tr></table></figure>\n\n<p>部署：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-redis.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-部署mongodb\"><a href=\"#3-部署mongodb\" class=\"headerlink\" title=\"3. 部署mongodb\"></a>3. 部署mongodb</h2><p>创建mongodb文件夹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /home/mongodb/data</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-挂载数据卷\"><a href=\"#3-1-挂载数据卷\" class=\"headerlink\" title=\"3.1 挂载数据卷\"></a>3.1 挂载数据卷</h3><p>note-mongodb-pvc.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p>使用</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mongodb-pvc.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看是否装好：</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/2.png\" alt=\"mongodb-pvc\"></p>\n<h3 id=\"3-2-部署\"><a href=\"#3-2-部署\" class=\"headerlink\" title=\"3.2 部署\"></a>3.2 部署</h3><p>note-mongodb.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">5c8b18289f7848e9b0af98e81562649d</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/data/db</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30017</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">27017</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mongodb.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>检查部署情况</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/3.png\" alt=\"mongodb\"></p>\n<h2 id=\"4-部署服务bert-flask\"><a href=\"#4-部署服务bert-flask\" class=\"headerlink\" title=\"4. 部署服务bert_flask\"></a>4. 部署服务bert_flask</h2><p>bert_flask.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bert-flask-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">bert-flask</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/bert_flask:v1.3.0</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span> <span class=\"comment\"># Always</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">5000</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bert-flask-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">5000</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30050</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f bert_flask.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>检查部署情况<br><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/4.png\" alt=\"bert_flask\"></p>\n<h2 id=\"5-部署服务note-cloud\"><a href=\"#5-部署服务note-cloud\" class=\"headerlink\" title=\"5. 部署服务note_cloud\"></a>5. 部署服务note_cloud</h2><h3 id=\"5-1-配置ConfigMap\"><a href=\"#5-1-配置ConfigMap\" class=\"headerlink\" title=\"5.1 配置ConfigMap\"></a>5.1 配置ConfigMap</h3><p>   新建application-prod.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">context-path:</span> <span class=\"string\">/api</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://note-mysql-service:3306/db_note</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">note-redis-service</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">adcc64a4a9b04324914626590fb52a1a</span></span><br><span class=\"line\">    <span class=\"attr\">lettuce:</span></span><br><span class=\"line\">      <span class=\"attr\">pool:</span></span><br><span class=\"line\">        <span class=\"attr\">max-active:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">max-idle:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">min-idle:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"attr\">time-between-eviction-runs:</span> <span class=\"string\">10s</span></span><br><span class=\"line\">    <span class=\"attr\">jackson:</span></span><br><span class=\"line\">      <span class=\"attr\">default-property-inclusion:</span> <span class=\"string\">non_null</span> <span class=\"comment\"># JSON处理时忽略非空字段</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://note-user:c88c1b8c2ed94010-8372efbc0879bdcb@note-mongodb-service:27017/mongodb_note</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\"><span class=\"attr\">jwt:</span></span><br><span class=\"line\">  <span class=\"attr\">base64-encoded-secret-key:</span> <span class=\"string\">lab_of_njust_cloud_computing</span> <span class=\"comment\"># jwt的签名密码</span></span><br><span class=\"line\"><span class=\"attr\">bert-base-chinese-service:</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">bert-flask-service</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create configmap note-cloud-config -n note --fromfile=application-prod.yml</span><br></pre></td></tr></table></figure>\n\n<p>   查看部署状态<br>   <img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/4.png\" alt=\"部署效果\"></p>\n<h3 id=\"5-2-部署服务\"><a href=\"#5-2-部署服务\" class=\"headerlink\" title=\"5.2 部署服务\"></a>5.2 部署服务</h3><p>note-cloud.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-cloud</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_cloud:v1.3.0</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span> <span class=\"comment\"># Always</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/app/config</span> <span class=\"comment\"># 配置文件将挂载到容器的/app/config目录</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">        <span class=\"attr\">configMap:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-config</span> <span class=\"comment\"># 引用之前创建的 ConfigMap</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30080</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-cloud.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看日志</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note</span><br><span class=\"line\">kubectl logs -f note-cloud-deployment-6687c5cb49-vc7kl -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-部署前端\"><a href=\"#6-部署前端\" class=\"headerlink\" title=\"6. 部署前端\"></a>6. 部署前端</h2><p>note-nginx.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-nginx-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-nginx</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-nginx:v2.2.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-nginx-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30088</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-nginx.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最终部署pod查看\"><a href=\"#最终部署pod查看\" class=\"headerlink\" title=\"最终部署pod查看\"></a>最终部署pod查看</h2><p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/5.png\" alt=\"pod\"></p>\n<p>访问（连校园网，关梯子）：</p>\n<p><a href=\"http://192.10.84.209:33395/cloudNote/\">http://192.10.84.209:33395/cloudNote/</a><br>账号：姓名小写拼音<br>密码：123456</p>\n<p>最终效果：<br><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/6.png\" alt=\"6\"></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover_type":"img","excerpt":"","more":"<blockquote>\n<p>起因是导师之前让两个研一的学弟学妹写了个前后端的云笔记系统，然后后面让我部署到服务器中，因此记录一下。</p>\n</blockquote>\n<h2 id=\"创建namespace\"><a href=\"#创建namespace\" class=\"headerlink\" title=\"创建namespace\"></a>创建namespace</h2><figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 创建namespace</span><br><span class=\"line\">kubectl create namespace note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-部署MySQL\"><a href=\"#1-部署MySQL\" class=\"headerlink\" title=\"1. 部署MySQL\"></a>1. 部署MySQL</h2><p>创建mysql文件夹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /home/mysql/data</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-1-挂载数据卷\"><a href=\"#1-1-挂载数据卷\" class=\"headerlink\" title=\"1.1 挂载数据卷\"></a>1.1 挂载数据卷</h3><p>note-mysql-pvc.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">\t<span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">\t<span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">\t<span class=\"attr\">requests:</span></span><br><span class=\"line\">\t  <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t<span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p>部署</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mysql-pvc.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看是否部署成功：</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/1.png\" alt=\"mysql是否部署成功\"></p>\n<h3 id=\"1-2-部署mysql\"><a href=\"#1-2-部署mysql\" class=\"headerlink\" title=\"1.2 部署mysql\"></a>1.2 部署mysql</h3><p>note-mysql.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">\t<span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">\t  <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">\t<span class=\"attr\">metadata:</span></span><br><span class=\"line\">\t  <span class=\"attr\">labels:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">\t<span class=\"attr\">spec:</span></span><br><span class=\"line\">\t  <span class=\"attr\">containers:</span></span><br><span class=\"line\">\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">env:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\">\t\t\t  <span class=\"attr\">value:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">ports:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">\t\t\t<span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">\t\t\t  <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">\t\t<span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">\t\t  <span class=\"attr\">claimName:</span> <span class=\"string\">note-mysql-pvc</span> <span class=\"comment\"># 使用之前创建的持久卷声明</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">\t<span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">\t<span class=\"attr\">nodePort:</span> <span class=\"number\">30006</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配</span></span><br><span class=\"line\">\t<span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<p>部署：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mysql.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-部署redis\"><a href=\"#2-部署redis\" class=\"headerlink\" title=\"2. 部署redis\"></a>2. 部署redis</h2><p>note-redis.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-redis-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-redis</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">redis:latest</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">REDIS_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">adcc64a4a9b04324914626590fb52a1a</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">6379</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-redis-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-redis-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30079</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span></span><br></pre></td></tr></table></figure>\n\n<p>部署：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-redis.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-部署mongodb\"><a href=\"#3-部署mongodb\" class=\"headerlink\" title=\"3. 部署mongodb\"></a>3. 部署mongodb</h2><p>创建mongodb文件夹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /home/mongodb/data</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-挂载数据卷\"><a href=\"#3-1-挂载数据卷\" class=\"headerlink\" title=\"3.1 挂载数据卷\"></a>3.1 挂载数据卷</h3><p>note-mongodb-pvc.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p>使用</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mongodb-pvc.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看是否装好：</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/2.png\" alt=\"mongodb-pvc\"></p>\n<h3 id=\"3-2-部署\"><a href=\"#3-2-部署\" class=\"headerlink\" title=\"3.2 部署\"></a>3.2 部署</h3><p>note-mongodb.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">5c8b18289f7848e9b0af98e81562649d</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/data/db</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30017</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">27017</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-mongodb.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>检查部署情况</p>\n<p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/3.png\" alt=\"mongodb\"></p>\n<h2 id=\"4-部署服务bert-flask\"><a href=\"#4-部署服务bert-flask\" class=\"headerlink\" title=\"4. 部署服务bert_flask\"></a>4. 部署服务bert_flask</h2><p>bert_flask.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bert-flask-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">bert-flask</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/bert_flask:v1.3.0</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span> <span class=\"comment\"># Always</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">5000</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bert-flask-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">bert-flask-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">5000</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30050</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f bert_flask.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>检查部署情况<br><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/4.png\" alt=\"bert_flask\"></p>\n<h2 id=\"5-部署服务note-cloud\"><a href=\"#5-部署服务note-cloud\" class=\"headerlink\" title=\"5. 部署服务note_cloud\"></a>5. 部署服务note_cloud</h2><h3 id=\"5-1-配置ConfigMap\"><a href=\"#5-1-配置ConfigMap\" class=\"headerlink\" title=\"5.1 配置ConfigMap\"></a>5.1 配置ConfigMap</h3><p>   新建application-prod.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">context-path:</span> <span class=\"string\">/api</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://note-mysql-service:3306/db_note</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">note-redis-service</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">adcc64a4a9b04324914626590fb52a1a</span></span><br><span class=\"line\">    <span class=\"attr\">lettuce:</span></span><br><span class=\"line\">      <span class=\"attr\">pool:</span></span><br><span class=\"line\">        <span class=\"attr\">max-active:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">max-idle:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">min-idle:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"attr\">time-between-eviction-runs:</span> <span class=\"string\">10s</span></span><br><span class=\"line\">    <span class=\"attr\">jackson:</span></span><br><span class=\"line\">      <span class=\"attr\">default-property-inclusion:</span> <span class=\"string\">non_null</span> <span class=\"comment\"># JSON处理时忽略非空字段</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://note-user:c88c1b8c2ed94010-8372efbc0879bdcb@note-mongodb-service:27017/mongodb_note</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">multipart:</span></span><br><span class=\"line\">      <span class=\"attr\">max-file-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\">      <span class=\"attr\">max-request-size:</span> <span class=\"string\">10MB</span></span><br><span class=\"line\"><span class=\"attr\">jwt:</span></span><br><span class=\"line\">  <span class=\"attr\">base64-encoded-secret-key:</span> <span class=\"string\">lab_of_njust_cloud_computing</span> <span class=\"comment\"># jwt的签名密码</span></span><br><span class=\"line\"><span class=\"attr\">bert-base-chinese-service:</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">bert-flask-service</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create configmap note-cloud-config -n note --fromfile=application-prod.yml</span><br></pre></td></tr></table></figure>\n\n<p>   查看部署状态<br>   <img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/4.png\" alt=\"部署效果\"></p>\n<h3 id=\"5-2-部署服务\"><a href=\"#5-2-部署服务\" class=\"headerlink\" title=\"5.2 部署服务\"></a>5.2 部署服务</h3><p>note-cloud.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-cloud</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_cloud:v1.3.0</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span> <span class=\"comment\"># Always</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/app/config</span> <span class=\"comment\"># 配置文件将挂载到容器的/app/config目录</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">        <span class=\"attr\">configMap:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-config</span> <span class=\"comment\"># 引用之前创建的 ConfigMap</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-cloud-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-cloud-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30080</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-cloud.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<p>查看日志</p>\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note</span><br><span class=\"line\">kubectl logs -f note-cloud-deployment-6687c5cb49-vc7kl -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-部署前端\"><a href=\"#6-部署前端\" class=\"headerlink\" title=\"6. 部署前端\"></a>6. 部署前端</h2><p>note-nginx.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-nginx-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-nginx</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-nginx:v2.2.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-nginx-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-nginx-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30088</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>helm</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f note-nginx.yaml -n note</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最终部署pod查看\"><a href=\"#最终部署pod查看\" class=\"headerlink\" title=\"最终部署pod查看\"></a>最终部署pod查看</h2><p><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/5.png\" alt=\"pod\"></p>\n<p>访问（连校园网，关梯子）：</p>\n<p><a href=\"http://192.10.84.209:33395/cloudNote/\">http://192.10.84.209:33395/cloudNote/</a><br>账号：姓名小写拼音<br>密码：123456</p>\n<p>最终效果：<br><img src=\"/../image/k8s%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F/6.png\" alt=\"6\"></p>\n"},{"title":"test","abbrlink":63534,"date":"2018-01-04T16:00:00.000Z","updated":"2023-09-22T15:15:35.500Z","keywords":null,"description":null,"top_img":null,"comments":1,"cover":"/img/cover/久岐忍.jpg","toc":null,"toc_number":null,"toc_style_simple":null,"copyright":null,"copyright_author":null,"copyright_author_href":null,"copyright_url":null,"copyright_info":null,"mathjax":null,"katex":null,"aplayer":null,"highlight_shrink":null,"aside":null,"abcjs":null,"_content":"\n# test\n\n这是我用来测试的文章，用来测试各种功能。\n","source":"_posts/test.md","raw":"---\ntitle: test\ntags:\n  - 测试\ncategories:\n  - 测试类\nabbrlink: 63534\ndate: 2018-01-05 00:00:00\nupdated:\nkeywords:\ndescription:\ntop_img:\ncomments:\ncover:\ntoc:\ntoc_number:\ntoc_style_simple:\ncopyright:\ncopyright_author:\ncopyright_author_href:\ncopyright_url:\ncopyright_info:\nmathjax:\nkatex:\naplayer:\nhighlight_shrink:\naside:\nabcjs:\n---\n\n# test\n\n这是我用来测试的文章，用来测试各种功能。\n","slug":"test","published":1,"layout":"post","photos":[],"link":"","_id":"clmuu294h000f8vgn431d64qw","content":"<h1 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h1><p>这是我用来测试的文章，用来测试各种功能。</p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover_type":"img","excerpt":"","more":"<h1 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h1><p>这是我用来测试的文章，用来测试各种功能。</p>\n"},{"title":"云笔记系统扩容","keywords":["k8s"],"description":"对k8s服务器上部署的云笔记系统进行扩容","abbrlink":36313,"date":"2023-09-20T06:50:58.000Z","updated":"2023-09-20T07:00:00.000Z","top_img":null,"comments":1,"cover":"/img/cover/久岐忍.jpg","toc":null,"toc_number":null,"toc_style_simple":null,"copyright":null,"copyright_author":null,"copyright_author_href":null,"copyright_url":null,"copyright_info":null,"mathjax":null,"katex":null,"aplayer":null,"highlight_shrink":null,"aside":null,"abcjs":null,"_content":"\n### 起因\n\n之前部署的云笔记系统的存储卷太小了，当用户数量增加的时候，笔记及用户信息会增大，这有可能会引起内存爆掉的情况。存储用户信息的 `mysql`和存储笔记信息的 `mongodb`在部署的时候我都设置了 `1G`的存储卷，这是远远不够的，因此需对其进行扩容。\n\n根据老师要求，需将内存从 `1G`扩展到  `50G`，这是针对存笔记系统的 `mongodb`，为了更加稳妥，跟学弟协商后决定将存用户数据的 `mysql`也扩充到 `10G`。\n\n### 大体思路：\n\n1. 确定 `mongodb`和 `mysql`的 `pod`所在的 `node`节点。\n2. 备份数据\n3. 删除旧的 `pod`\n4. 分别修改 `mongodb`和 `mysql`的 `pv`、 `pvc`为 `50Gi`、 `10Gi`。\n5. 指定 `mongodb`和 `mysql`的 `pv`、 `pvc`及 `mongodb`、 `mysql`部署的亲和性，让其部署在指定 `node`节点，便于扩容。\n6. 重新部署相应 `pod`\n7. 扩容指定的 `mongodb`、 `mysql`部署的节点的虚拟机。\n\n> 注：本笔记图片里的 `deployment`的编号等信息可能会不一样，因为自己操作的时候可能会删了pod在重建导致其编号及时间等不一样，图片仅用于描述过程及结果。\n\n## 1. 确定pod所在的node节点\n\n首先远程连接 `131`服务器。\n\n云笔记系统有 `6`个 `pod`，在 `note`空间里，如下所示：\n\n```bash\nkubectl get pod -n note\n```\n\n![pod](../image/云笔记系统扩容/pod.png)\n\n需确定 `mongodb`、 `mysql`所在的 `node`节点，命令如下：\n\n```bash\nkubectl get pod -n note -o wide\n```\n\n![pod-node](../image/云笔记系统扩容/pod-node.png)\n\n由上图可知， `mongodb`和 `mysql`的 `pod`分别被部署到了 `k8s-node6`、 `k8s-node7`节点。\n\n## 2. 备份数据\n\n问学长得知， `k8s-node6`、 `k8s-node7`节点位于 `122`服务器\n\n远程连接 `122`服务器后，打开 `VMWare Workstation Pro`，登录 `node6`节点：\n\n![vmware](../image/云笔记系统扩容/vmware.png)\n\n账号密码为 `root 123456`，登陆后如下：\n\n![login](../image/云笔记系统扩容/login.png)\n\n按下面命令将数据拷贝到 `tmp/backup`文件夹下进行备份：\n\n![backup](../image/云笔记系统扩容/backup.png)\n\n对 `node7`下的 `mysql`进行同样操作，不再赘述。\n\n为了保险起见，使用 `xShell`中的 `xftp`将备份的文件再备份到桌面一份：\n\n![xftp](../image/云笔记系统扩容/xftp.png)\n\n打开 `xshell`点击新建文件传输，将 `/home`下的 `mongodb`文件夹拖动到桌面。\n\n![backup-desktop](../image/云笔记系统扩容/backup-desktop.png)\n\n对 `node7`下的 `mysql`进行同样操作，不再赘述。\n\n## 3. 删除旧的pod\n\n删除旧的 `pod`：\n\n```yaml\nkubectl delete -f note-mysql-pvc.yaml -n note\nkubectl delete -f note-mysql.yaml -n note\nkubectl delete -f note-mongodb-pvc.yaml -n note\nkubectl delete -f note-mongodb.yaml -n note\n```\n\n![delete-pod](../image/云笔记系统扩容/delete-pod.png)\n\n此时查看 `pod`结果：\n\n```yaml\nkubectl get pod -n note\n```\n\n![pod-after-deleted](../image/云笔记系统扩容/pod-after-deleted.png)\n\n`mongodb`和 `mysql`的 `pod`已经被删掉。\n\n## 4. 修改pv、pvc\n\n将相关的 `yaml`文件修改为如下内容：\n\n`note-mongodb-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 50Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n`note-mysql-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mysql/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: \"\"\n  volumeName: note-mysql-pv\n```\n\n`yaml`文件里已经将内存修改为目标内存。\n\n## 5. 指定亲和性\n\n这里的亲和性是 `Affinity`，指定了这个后会让其部署在指定标签的 `node`节点上。这样仅需将指定的 `node`节点的虚拟机扩容即可。\n\n首先需要为 `node`节点添加标签。如下所示：\n\n```bash\nkubectl get nodes --show-labels\n\n# 为节点6和7添加label\nkubectl label nodes k8s-node6 notelabel=mongodb\nkubectl label nodes k8s-node7 notelabel=mysql\n```\n\n![add-labels](../image/云笔记系统扩容/add-labels.png)\n\n指定完标签就可以添加亲和性了，如下：\n\n`note-mongodb-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 50Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: notelabel\n          operator: In\n          values:\n          - mongodb\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n`note-mysql-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mysql/data # 主机上的数据存储路径\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: notelabel\n          operator: In\n          values:\n          - mysql\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: \"\"\n  volumeName: note-mysql-pv\n```\n\n`note-mongodb.yaml`\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mongodb-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mongodb-pod\n  template:\n    metadata:\n      labels:\n        app: note-mongodb-pod\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: notelabel\n                operator: In\n                values:\n                - mongodb\n      containers:\n        - name: note-mongodb\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 27017\n          env:\n            - name: MONGO_INITDB_ROOT_USERNAME\n              value: admin\n            - name: MONGO_INITDB_ROOT_PASSWORD\n              value: 5c8b18289f7848e9b0af98e81562649d\n          volumeMounts:\n            - name: note-mongodb-persistent-storage\n              mountPath: /data/db\n      volumes:\n        - name: note-mongodb-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mongodb-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mongodb-service\nspec:\n  selector:\n    app: note-mongodb-pod\n  type: NodePort # service类型\n  ports:\n  - port: 27017\n    nodePort: 30017 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 27017\n```\n\n`note-mysql.yaml`\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mysql-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mysql-pod\n  template:\n    metadata:\n      labels:\n        app: note-mysql-pod\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: notelabel\n                operator: In\n                values:\n                - mysql\n      containers:\n        - name: note-mysql\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: MYSQL_ROOT_PASSWORD\n              value: dfa6f1b032ee42ed95d12647225f2ff4\n          ports:\n            - containerPort: 3306\n          volumeMounts:\n            - name: note-mysql-persistent-storage\n              mountPath: /var/lib/mysql\n      volumes:\n        - name: note-mysql-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mysql-pvc # 使用之前创建的持久卷声明\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mysql-service\nspec:\n  selector:\n    app: note-mysql-pod\n  type: NodePort # service类型\n  ports:\n  - port: 3306\n    nodePort: 30006 # 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配\n    targetPort: 3306\n```\n\n这样，亲和性就修改完毕了。\n\n## 6. 重新部署相应的pod\n\n接下来按 `5. 指定亲和性` 所修改的 `yaml`重新进行 `pod`部署：\n\n```yaml\nkubectl create -f note-mysql-pvc.yaml -n note\nkubectl create -f note-mysql.yaml -n note\nkubectl create -f note-mongodb-pvc.yaml -n note\nkubectl create -f note-mongodb.yaml -n note\n```\n\n![pod-deploy](../image/云笔记系统扩容/pod-deploy.png)\n\n查看部署的结果：\n\n```yaml\nkubectl get pod -n note -o wide\n```\n\n![pod-after-deploy](../image/云笔记系统扩容/pod-after-deploy.png)\n\n可以看到已经将 `mongodb`和 `mysql`分别部署到了节点 `6`和 `7`上。\n\n## 7. 扩容节点的虚拟机\n\n远程连接 `122`服务器后，打开 `VMWare Workstation Pro`，如下：\n\n![vmware](../image/云笔记系统扩容/vmware.png)\n\n对于 `sx-k8s-node6`，先双击，然后点击上面的橙色运行按钮右边的下拉倒三角，关机。\n\n![shutdown](../image/云笔记系统扩容/shutdown.png)\n\n然后右键 `sx-k8s-node6`，点设置\n\n![setting](../image/云笔记系统扩容/setting.png)\n\n点击硬盘后点击右下角扩展\n\n![expand](../image/云笔记系统扩容/expand.png)\n\n对硬盘容量进行修改。\n\n这里原本是 `40G`，我增加了 `50G`后变为了 `90G`。\n\n`sx-k8s-node7`的操作类似，不再赘述。\n\n此时打开网址，访问成功！扩容成功！\n\n## 访问\n访问（连校园网，关梯子）：\n\nhttp://192.10.84.209:33395/cloudNote/\n\n账号：姓名小写拼音\n\n密码：123456\n\n效果：\n\n![6](../image/云笔记系统扩容/6.png)\n","source":"_posts/云笔记系统扩容.md","raw":"---\ntitle: 云笔记系统扩容\ntags:\n  - k8s\n  - Kubernetes\n  - 教程\ncategories:\n  - Kubernetes\nkeywords:\n  - k8s\ndescription: 对k8s服务器上部署的云笔记系统进行扩容\nabbrlink: 36313\ndate: 2023-09-20 14:50:58\nupdated: 2023-09-20 15:00:00\ntop_img:\ncomments:\ncover:\ntoc:\ntoc_number:\ntoc_style_simple:\ncopyright:\ncopyright_author:\ncopyright_author_href:\ncopyright_url:\ncopyright_info:\nmathjax:\nkatex:\naplayer:\nhighlight_shrink:\naside:\nabcjs:\n---\n\n### 起因\n\n之前部署的云笔记系统的存储卷太小了，当用户数量增加的时候，笔记及用户信息会增大，这有可能会引起内存爆掉的情况。存储用户信息的 `mysql`和存储笔记信息的 `mongodb`在部署的时候我都设置了 `1G`的存储卷，这是远远不够的，因此需对其进行扩容。\n\n根据老师要求，需将内存从 `1G`扩展到  `50G`，这是针对存笔记系统的 `mongodb`，为了更加稳妥，跟学弟协商后决定将存用户数据的 `mysql`也扩充到 `10G`。\n\n### 大体思路：\n\n1. 确定 `mongodb`和 `mysql`的 `pod`所在的 `node`节点。\n2. 备份数据\n3. 删除旧的 `pod`\n4. 分别修改 `mongodb`和 `mysql`的 `pv`、 `pvc`为 `50Gi`、 `10Gi`。\n5. 指定 `mongodb`和 `mysql`的 `pv`、 `pvc`及 `mongodb`、 `mysql`部署的亲和性，让其部署在指定 `node`节点，便于扩容。\n6. 重新部署相应 `pod`\n7. 扩容指定的 `mongodb`、 `mysql`部署的节点的虚拟机。\n\n> 注：本笔记图片里的 `deployment`的编号等信息可能会不一样，因为自己操作的时候可能会删了pod在重建导致其编号及时间等不一样，图片仅用于描述过程及结果。\n\n## 1. 确定pod所在的node节点\n\n首先远程连接 `131`服务器。\n\n云笔记系统有 `6`个 `pod`，在 `note`空间里，如下所示：\n\n```bash\nkubectl get pod -n note\n```\n\n![pod](../image/云笔记系统扩容/pod.png)\n\n需确定 `mongodb`、 `mysql`所在的 `node`节点，命令如下：\n\n```bash\nkubectl get pod -n note -o wide\n```\n\n![pod-node](../image/云笔记系统扩容/pod-node.png)\n\n由上图可知， `mongodb`和 `mysql`的 `pod`分别被部署到了 `k8s-node6`、 `k8s-node7`节点。\n\n## 2. 备份数据\n\n问学长得知， `k8s-node6`、 `k8s-node7`节点位于 `122`服务器\n\n远程连接 `122`服务器后，打开 `VMWare Workstation Pro`，登录 `node6`节点：\n\n![vmware](../image/云笔记系统扩容/vmware.png)\n\n账号密码为 `root 123456`，登陆后如下：\n\n![login](../image/云笔记系统扩容/login.png)\n\n按下面命令将数据拷贝到 `tmp/backup`文件夹下进行备份：\n\n![backup](../image/云笔记系统扩容/backup.png)\n\n对 `node7`下的 `mysql`进行同样操作，不再赘述。\n\n为了保险起见，使用 `xShell`中的 `xftp`将备份的文件再备份到桌面一份：\n\n![xftp](../image/云笔记系统扩容/xftp.png)\n\n打开 `xshell`点击新建文件传输，将 `/home`下的 `mongodb`文件夹拖动到桌面。\n\n![backup-desktop](../image/云笔记系统扩容/backup-desktop.png)\n\n对 `node7`下的 `mysql`进行同样操作，不再赘述。\n\n## 3. 删除旧的pod\n\n删除旧的 `pod`：\n\n```yaml\nkubectl delete -f note-mysql-pvc.yaml -n note\nkubectl delete -f note-mysql.yaml -n note\nkubectl delete -f note-mongodb-pvc.yaml -n note\nkubectl delete -f note-mongodb.yaml -n note\n```\n\n![delete-pod](../image/云笔记系统扩容/delete-pod.png)\n\n此时查看 `pod`结果：\n\n```yaml\nkubectl get pod -n note\n```\n\n![pod-after-deleted](../image/云笔记系统扩容/pod-after-deleted.png)\n\n`mongodb`和 `mysql`的 `pod`已经被删掉。\n\n## 4. 修改pv、pvc\n\n将相关的 `yaml`文件修改为如下内容：\n\n`note-mongodb-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 50Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n`note-mysql-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mysql/data # 主机上的数据存储路径\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: \"\"\n  volumeName: note-mysql-pv\n```\n\n`yaml`文件里已经将内存修改为目标内存。\n\n## 5. 指定亲和性\n\n这里的亲和性是 `Affinity`，指定了这个后会让其部署在指定标签的 `node`节点上。这样仅需将指定的 `node`节点的虚拟机扩容即可。\n\n首先需要为 `node`节点添加标签。如下所示：\n\n```bash\nkubectl get nodes --show-labels\n\n# 为节点6和7添加label\nkubectl label nodes k8s-node6 notelabel=mongodb\nkubectl label nodes k8s-node7 notelabel=mysql\n```\n\n![add-labels](../image/云笔记系统扩容/add-labels.png)\n\n指定完标签就可以添加亲和性了，如下：\n\n`note-mongodb-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mongodb-pv\nspec:\n  capacity:\n    storage: 50Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mongodb/data # 主机上的数据存储路径\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: notelabel\n          operator: In\n          values:\n          - mongodb\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mongodb-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: \"\"\n  volumeName: note-mongodb-pv\n```\n\n`note-mysql-pvc.yaml`\n\n```yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: note-mysql-pv\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: /home/mysql/data # 主机上的数据存储路径\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: notelabel\n          operator: In\n          values:\n          - mysql\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: note-mysql-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: \"\"\n  volumeName: note-mysql-pv\n```\n\n`note-mongodb.yaml`\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mongodb-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mongodb-pod\n  template:\n    metadata:\n      labels:\n        app: note-mongodb-pod\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: notelabel\n                operator: In\n                values:\n                - mongodb\n      containers:\n        - name: note-mongodb\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 27017\n          env:\n            - name: MONGO_INITDB_ROOT_USERNAME\n              value: admin\n            - name: MONGO_INITDB_ROOT_PASSWORD\n              value: 5c8b18289f7848e9b0af98e81562649d\n          volumeMounts:\n            - name: note-mongodb-persistent-storage\n              mountPath: /data/db\n      volumes:\n        - name: note-mongodb-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mongodb-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mongodb-service\nspec:\n  selector:\n    app: note-mongodb-pod\n  type: NodePort # service类型\n  ports:\n  - port: 27017\n    nodePort: 30017 # 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配\n    targetPort: 27017\n```\n\n`note-mysql.yaml`\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: note-mysql-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: note-mysql-pod\n  template:\n    metadata:\n      labels:\n        app: note-mysql-pod\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: notelabel\n                operator: In\n                values:\n                - mysql\n      containers:\n        - name: note-mysql\n          image: registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: MYSQL_ROOT_PASSWORD\n              value: dfa6f1b032ee42ed95d12647225f2ff4\n          ports:\n            - containerPort: 3306\n          volumeMounts:\n            - name: note-mysql-persistent-storage\n              mountPath: /var/lib/mysql\n      volumes:\n        - name: note-mysql-persistent-storage\n          persistentVolumeClaim:\n            claimName: note-mysql-pvc # 使用之前创建的持久卷声明\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: note-mysql-service\nspec:\n  selector:\n    app: note-mysql-pod\n  type: NodePort # service类型\n  ports:\n  - port: 3306\n    nodePort: 30006 # 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配\n    targetPort: 3306\n```\n\n这样，亲和性就修改完毕了。\n\n## 6. 重新部署相应的pod\n\n接下来按 `5. 指定亲和性` 所修改的 `yaml`重新进行 `pod`部署：\n\n```yaml\nkubectl create -f note-mysql-pvc.yaml -n note\nkubectl create -f note-mysql.yaml -n note\nkubectl create -f note-mongodb-pvc.yaml -n note\nkubectl create -f note-mongodb.yaml -n note\n```\n\n![pod-deploy](../image/云笔记系统扩容/pod-deploy.png)\n\n查看部署的结果：\n\n```yaml\nkubectl get pod -n note -o wide\n```\n\n![pod-after-deploy](../image/云笔记系统扩容/pod-after-deploy.png)\n\n可以看到已经将 `mongodb`和 `mysql`分别部署到了节点 `6`和 `7`上。\n\n## 7. 扩容节点的虚拟机\n\n远程连接 `122`服务器后，打开 `VMWare Workstation Pro`，如下：\n\n![vmware](../image/云笔记系统扩容/vmware.png)\n\n对于 `sx-k8s-node6`，先双击，然后点击上面的橙色运行按钮右边的下拉倒三角，关机。\n\n![shutdown](../image/云笔记系统扩容/shutdown.png)\n\n然后右键 `sx-k8s-node6`，点设置\n\n![setting](../image/云笔记系统扩容/setting.png)\n\n点击硬盘后点击右下角扩展\n\n![expand](../image/云笔记系统扩容/expand.png)\n\n对硬盘容量进行修改。\n\n这里原本是 `40G`，我增加了 `50G`后变为了 `90G`。\n\n`sx-k8s-node7`的操作类似，不再赘述。\n\n此时打开网址，访问成功！扩容成功！\n\n## 访问\n访问（连校园网，关梯子）：\n\nhttp://192.10.84.209:33395/cloudNote/\n\n账号：姓名小写拼音\n\n密码：123456\n\n效果：\n\n![6](../image/云笔记系统扩容/6.png)\n","slug":"云笔记系统扩容","published":1,"layout":"post","photos":[],"link":"","_id":"clmuu294i000i8vgn1cpz0lan","content":"<h3 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h3><p>之前部署的云笔记系统的存储卷太小了，当用户数量增加的时候，笔记及用户信息会增大，这有可能会引起内存爆掉的情况。存储用户信息的 <code>mysql</code>和存储笔记信息的 <code>mongodb</code>在部署的时候我都设置了 <code>1G</code>的存储卷，这是远远不够的，因此需对其进行扩容。</p>\n<p>根据老师要求，需将内存从 <code>1G</code>扩展到  <code>50G</code>，这是针对存笔记系统的 <code>mongodb</code>，为了更加稳妥，跟学弟协商后决定将存用户数据的 <code>mysql</code>也扩充到 <code>10G</code>。</p>\n<h3 id=\"大体思路：\"><a href=\"#大体思路：\" class=\"headerlink\" title=\"大体思路：\"></a>大体思路：</h3><ol>\n<li>确定 <code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>所在的 <code>node</code>节点。</li>\n<li>备份数据</li>\n<li>删除旧的 <code>pod</code></li>\n<li>分别修改 <code>mongodb</code>和 <code>mysql</code>的 <code>pv</code>、 <code>pvc</code>为 <code>50Gi</code>、 <code>10Gi</code>。</li>\n<li>指定 <code>mongodb</code>和 <code>mysql</code>的 <code>pv</code>、 <code>pvc</code>及 <code>mongodb</code>、 <code>mysql</code>部署的亲和性，让其部署在指定 <code>node</code>节点，便于扩容。</li>\n<li>重新部署相应 <code>pod</code></li>\n<li>扩容指定的 <code>mongodb</code>、 <code>mysql</code>部署的节点的虚拟机。</li>\n</ol>\n<blockquote>\n<p>注：本笔记图片里的 <code>deployment</code>的编号等信息可能会不一样，因为自己操作的时候可能会删了pod在重建导致其编号及时间等不一样，图片仅用于描述过程及结果。</p>\n</blockquote>\n<h2 id=\"1-确定pod所在的node节点\"><a href=\"#1-确定pod所在的node节点\" class=\"headerlink\" title=\"1. 确定pod所在的node节点\"></a>1. 确定pod所在的node节点</h2><p>首先远程连接 <code>131</code>服务器。</p>\n<p>云笔记系统有 <code>6</code>个 <code>pod</code>，在 <code>note</code>空间里，如下所示：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod.png\" alt=\"pod\"></p>\n<p>需确定 <code>mongodb</code>、 <code>mysql</code>所在的 <code>node</code>节点，命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note -o wide</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-node.png\" alt=\"pod-node\"></p>\n<p>由上图可知， <code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>分别被部署到了 <code>k8s-node6</code>、 <code>k8s-node7</code>节点。</p>\n<h2 id=\"2-备份数据\"><a href=\"#2-备份数据\" class=\"headerlink\" title=\"2. 备份数据\"></a>2. 备份数据</h2><p>问学长得知， <code>k8s-node6</code>、 <code>k8s-node7</code>节点位于 <code>122</code>服务器</p>\n<p>远程连接 <code>122</code>服务器后，打开 <code>VMWare Workstation Pro</code>，登录 <code>node6</code>节点：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/vmware.png\" alt=\"vmware\"></p>\n<p>账号密码为 <code>root 123456</code>，登陆后如下：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/login.png\" alt=\"login\"></p>\n<p>按下面命令将数据拷贝到 <code>tmp/backup</code>文件夹下进行备份：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/backup.png\" alt=\"backup\"></p>\n<p>对 <code>node7</code>下的 <code>mysql</code>进行同样操作，不再赘述。</p>\n<p>为了保险起见，使用 <code>xShell</code>中的 <code>xftp</code>将备份的文件再备份到桌面一份：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/xftp.png\" alt=\"xftp\"></p>\n<p>打开 <code>xshell</code>点击新建文件传输，将 <code>/home</code>下的 <code>mongodb</code>文件夹拖动到桌面。</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/backup-desktop.png\" alt=\"backup-desktop\"></p>\n<p>对 <code>node7</code>下的 <code>mysql</code>进行同样操作，不再赘述。</p>\n<h2 id=\"3-删除旧的pod\"><a href=\"#3-删除旧的pod\" class=\"headerlink\" title=\"3. 删除旧的pod\"></a>3. 删除旧的pod</h2><p>删除旧的 <code>pod</code>：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/delete-pod.png\" alt=\"delete-pod\"></p>\n<p>此时查看 <code>pod</code>结果：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">pod</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-after-deleted.png\" alt=\"pod-after-deleted\"></p>\n<p><code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>已经被删掉。</p>\n<h2 id=\"4-修改pv、pvc\"><a href=\"#4-修改pv、pvc\" class=\"headerlink\" title=\"4. 修改pv、pvc\"></a>4. 修改pv、pvc</h2><p>将相关的 <code>yaml</code>文件修改为如下内容：</p>\n<p><code>note-mongodb-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>yaml</code>文件里已经将内存修改为目标内存。</p>\n<h2 id=\"5-指定亲和性\"><a href=\"#5-指定亲和性\" class=\"headerlink\" title=\"5. 指定亲和性\"></a>5. 指定亲和性</h2><p>这里的亲和性是 <code>Affinity</code>，指定了这个后会让其部署在指定标签的 <code>node</code>节点上。这样仅需将指定的 <code>node</code>节点的虚拟机扩容即可。</p>\n<p>首先需要为 <code>node</code>节点添加标签。如下所示：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get nodes --show-labels</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为节点6和7添加label</span></span><br><span class=\"line\">kubectl label nodes k8s-node6 notelabel=mongodb</span><br><span class=\"line\">kubectl label nodes k8s-node7 notelabel=mysql</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/add-labels.png\" alt=\"add-labels\"></p>\n<p>指定完标签就可以添加亲和性了，如下：</p>\n<p><code>note-mongodb-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\">  <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">    <span class=\"attr\">required:</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">          <span class=\"attr\">values:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mongodb</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\">  <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">    <span class=\"attr\">required:</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">          <span class=\"attr\">values:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mongodb.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">mongodb</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">5c8b18289f7848e9b0af98e81562649d</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/data/db</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30017</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">27017</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mysql-pvc</span> <span class=\"comment\"># 使用之前创建的持久卷声明</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30006</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<p>这样，亲和性就修改完毕了。</p>\n<h2 id=\"6-重新部署相应的pod\"><a href=\"#6-重新部署相应的pod\" class=\"headerlink\" title=\"6. 重新部署相应的pod\"></a>6. 重新部署相应的pod</h2><p>接下来按 <code>5. 指定亲和性</code> 所修改的 <code>yaml</code>重新进行 <code>pod</code>部署：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-deploy.png\" alt=\"pod-deploy\"></p>\n<p>查看部署的结果：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">pod</span> <span class=\"string\">-n</span> <span class=\"string\">note</span> <span class=\"string\">-o</span> <span class=\"string\">wide</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-after-deploy.png\" alt=\"pod-after-deploy\"></p>\n<p>可以看到已经将 <code>mongodb</code>和 <code>mysql</code>分别部署到了节点 <code>6</code>和 <code>7</code>上。</p>\n<h2 id=\"7-扩容节点的虚拟机\"><a href=\"#7-扩容节点的虚拟机\" class=\"headerlink\" title=\"7. 扩容节点的虚拟机\"></a>7. 扩容节点的虚拟机</h2><p>远程连接 <code>122</code>服务器后，打开 <code>VMWare Workstation Pro</code>，如下：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/vmware.png\" alt=\"vmware\"></p>\n<p>对于 <code>sx-k8s-node6</code>，先双击，然后点击上面的橙色运行按钮右边的下拉倒三角，关机。</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/shutdown.png\" alt=\"shutdown\"></p>\n<p>然后右键 <code>sx-k8s-node6</code>，点设置</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/setting.png\" alt=\"setting\"></p>\n<p>点击硬盘后点击右下角扩展</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/expand.png\" alt=\"expand\"></p>\n<p>对硬盘容量进行修改。</p>\n<p>这里原本是 <code>40G</code>，我增加了 <code>50G</code>后变为了 <code>90G</code>。</p>\n<p><code>sx-k8s-node7</code>的操作类似，不再赘述。</p>\n<p>此时打开网址，访问成功！扩容成功！</p>\n<h2 id=\"访问\"><a href=\"#访问\" class=\"headerlink\" title=\"访问\"></a>访问</h2><p>访问（连校园网，关梯子）：</p>\n<p><a href=\"http://192.10.84.209:33395/cloudNote/\">http://192.10.84.209:33395/cloudNote/</a></p>\n<p>账号：姓名小写拼音</p>\n<p>密码：123456</p>\n<p>效果：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/6.png\" alt=\"6\"></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、简单且强大的网志框架"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"视频网站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中国最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover_type":"img","excerpt":"","more":"<h3 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h3><p>之前部署的云笔记系统的存储卷太小了，当用户数量增加的时候，笔记及用户信息会增大，这有可能会引起内存爆掉的情况。存储用户信息的 <code>mysql</code>和存储笔记信息的 <code>mongodb</code>在部署的时候我都设置了 <code>1G</code>的存储卷，这是远远不够的，因此需对其进行扩容。</p>\n<p>根据老师要求，需将内存从 <code>1G</code>扩展到  <code>50G</code>，这是针对存笔记系统的 <code>mongodb</code>，为了更加稳妥，跟学弟协商后决定将存用户数据的 <code>mysql</code>也扩充到 <code>10G</code>。</p>\n<h3 id=\"大体思路：\"><a href=\"#大体思路：\" class=\"headerlink\" title=\"大体思路：\"></a>大体思路：</h3><ol>\n<li>确定 <code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>所在的 <code>node</code>节点。</li>\n<li>备份数据</li>\n<li>删除旧的 <code>pod</code></li>\n<li>分别修改 <code>mongodb</code>和 <code>mysql</code>的 <code>pv</code>、 <code>pvc</code>为 <code>50Gi</code>、 <code>10Gi</code>。</li>\n<li>指定 <code>mongodb</code>和 <code>mysql</code>的 <code>pv</code>、 <code>pvc</code>及 <code>mongodb</code>、 <code>mysql</code>部署的亲和性，让其部署在指定 <code>node</code>节点，便于扩容。</li>\n<li>重新部署相应 <code>pod</code></li>\n<li>扩容指定的 <code>mongodb</code>、 <code>mysql</code>部署的节点的虚拟机。</li>\n</ol>\n<blockquote>\n<p>注：本笔记图片里的 <code>deployment</code>的编号等信息可能会不一样，因为自己操作的时候可能会删了pod在重建导致其编号及时间等不一样，图片仅用于描述过程及结果。</p>\n</blockquote>\n<h2 id=\"1-确定pod所在的node节点\"><a href=\"#1-确定pod所在的node节点\" class=\"headerlink\" title=\"1. 确定pod所在的node节点\"></a>1. 确定pod所在的node节点</h2><p>首先远程连接 <code>131</code>服务器。</p>\n<p>云笔记系统有 <code>6</code>个 <code>pod</code>，在 <code>note</code>空间里，如下所示：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod.png\" alt=\"pod\"></p>\n<p>需确定 <code>mongodb</code>、 <code>mysql</code>所在的 <code>node</code>节点，命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n note -o wide</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-node.png\" alt=\"pod-node\"></p>\n<p>由上图可知， <code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>分别被部署到了 <code>k8s-node6</code>、 <code>k8s-node7</code>节点。</p>\n<h2 id=\"2-备份数据\"><a href=\"#2-备份数据\" class=\"headerlink\" title=\"2. 备份数据\"></a>2. 备份数据</h2><p>问学长得知， <code>k8s-node6</code>、 <code>k8s-node7</code>节点位于 <code>122</code>服务器</p>\n<p>远程连接 <code>122</code>服务器后，打开 <code>VMWare Workstation Pro</code>，登录 <code>node6</code>节点：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/vmware.png\" alt=\"vmware\"></p>\n<p>账号密码为 <code>root 123456</code>，登陆后如下：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/login.png\" alt=\"login\"></p>\n<p>按下面命令将数据拷贝到 <code>tmp/backup</code>文件夹下进行备份：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/backup.png\" alt=\"backup\"></p>\n<p>对 <code>node7</code>下的 <code>mysql</code>进行同样操作，不再赘述。</p>\n<p>为了保险起见，使用 <code>xShell</code>中的 <code>xftp</code>将备份的文件再备份到桌面一份：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/xftp.png\" alt=\"xftp\"></p>\n<p>打开 <code>xshell</code>点击新建文件传输，将 <code>/home</code>下的 <code>mongodb</code>文件夹拖动到桌面。</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/backup-desktop.png\" alt=\"backup-desktop\"></p>\n<p>对 <code>node7</code>下的 <code>mysql</code>进行同样操作，不再赘述。</p>\n<h2 id=\"3-删除旧的pod\"><a href=\"#3-删除旧的pod\" class=\"headerlink\" title=\"3. 删除旧的pod\"></a>3. 删除旧的pod</h2><p>删除旧的 <code>pod</code>：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">delete</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/delete-pod.png\" alt=\"delete-pod\"></p>\n<p>此时查看 <code>pod</code>结果：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">pod</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-after-deleted.png\" alt=\"pod-after-deleted\"></p>\n<p><code>mongodb</code>和 <code>mysql</code>的 <code>pod</code>已经被删掉。</p>\n<h2 id=\"4-修改pv、pvc\"><a href=\"#4-修改pv、pvc\" class=\"headerlink\" title=\"4. 修改pv、pvc\"></a>4. 修改pv、pvc</h2><p>将相关的 <code>yaml</code>文件修改为如下内容：</p>\n<p><code>note-mongodb-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>yaml</code>文件里已经将内存修改为目标内存。</p>\n<h2 id=\"5-指定亲和性\"><a href=\"#5-指定亲和性\" class=\"headerlink\" title=\"5. 指定亲和性\"></a>5. 指定亲和性</h2><p>这里的亲和性是 <code>Affinity</code>，指定了这个后会让其部署在指定标签的 <code>node</code>节点上。这样仅需将指定的 <code>node</code>节点的虚拟机扩容即可。</p>\n<p>首先需要为 <code>node</code>节点添加标签。如下所示：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get nodes --show-labels</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为节点6和7添加label</span></span><br><span class=\"line\">kubectl label nodes k8s-node6 notelabel=mongodb</span><br><span class=\"line\">kubectl label nodes k8s-node7 notelabel=mysql</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/add-labels.png\" alt=\"add-labels\"></p>\n<p>指定完标签就可以添加亲和性了，如下：</p>\n<p><code>note-mongodb-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mongodb/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\">  <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">    <span class=\"attr\">required:</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">          <span class=\"attr\">values:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mongodb</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">50Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mongodb-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql-pvc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/home/mysql/data</span> <span class=\"comment\"># 主机上的数据存储路径</span></span><br><span class=\"line\">  <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">    <span class=\"attr\">required:</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">          <span class=\"attr\">values:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-pvc</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">10Gi</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumeName:</span> <span class=\"string\">note-mysql-pv</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mongodb.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">mongodb</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note-mongodb:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">5c8b18289f7848e9b0af98e81562649d</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/data/db</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mongodb-pvc</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mongodb-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mongodb-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">27017</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30017</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767),如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">27017</span></span><br></pre></td></tr></table></figure>\n\n<p><code>note-mysql.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">notelabel</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lucas-njfu/note_mysql:v1.1.0</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">dfa6f1b032ee42ed95d12647225f2ff4</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-persistent-storage</span></span><br><span class=\"line\">          <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">            <span class=\"attr\">claimName:</span> <span class=\"string\">note-mysql-pvc</span> <span class=\"comment\"># 使用之前创建的持久卷声明</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">note-mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">note-mysql-pod</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span> <span class=\"comment\"># service类型</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30006</span> <span class=\"comment\"># 指定绑定的node的端口(默认的取值范围是：30000-32767), 如果不指定，会默认分配</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<p>这样，亲和性就修改完毕了。</p>\n<h2 id=\"6-重新部署相应的pod\"><a href=\"#6-重新部署相应的pod\" class=\"headerlink\" title=\"6. 重新部署相应的pod\"></a>6. 重新部署相应的pod</h2><p>接下来按 <code>5. 指定亲和性</code> 所修改的 <code>yaml</code>重新进行 <code>pod</code>部署：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mysql.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb-pvc.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">create</span> <span class=\"string\">-f</span> <span class=\"string\">note-mongodb.yaml</span> <span class=\"string\">-n</span> <span class=\"string\">note</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-deploy.png\" alt=\"pod-deploy\"></p>\n<p>查看部署的结果：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">pod</span> <span class=\"string\">-n</span> <span class=\"string\">note</span> <span class=\"string\">-o</span> <span class=\"string\">wide</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/pod-after-deploy.png\" alt=\"pod-after-deploy\"></p>\n<p>可以看到已经将 <code>mongodb</code>和 <code>mysql</code>分别部署到了节点 <code>6</code>和 <code>7</code>上。</p>\n<h2 id=\"7-扩容节点的虚拟机\"><a href=\"#7-扩容节点的虚拟机\" class=\"headerlink\" title=\"7. 扩容节点的虚拟机\"></a>7. 扩容节点的虚拟机</h2><p>远程连接 <code>122</code>服务器后，打开 <code>VMWare Workstation Pro</code>，如下：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/vmware.png\" alt=\"vmware\"></p>\n<p>对于 <code>sx-k8s-node6</code>，先双击，然后点击上面的橙色运行按钮右边的下拉倒三角，关机。</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/shutdown.png\" alt=\"shutdown\"></p>\n<p>然后右键 <code>sx-k8s-node6</code>，点设置</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/setting.png\" alt=\"setting\"></p>\n<p>点击硬盘后点击右下角扩展</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/expand.png\" alt=\"expand\"></p>\n<p>对硬盘容量进行修改。</p>\n<p>这里原本是 <code>40G</code>，我增加了 <code>50G</code>后变为了 <code>90G</code>。</p>\n<p><code>sx-k8s-node7</code>的操作类似，不再赘述。</p>\n<p>此时打开网址，访问成功！扩容成功！</p>\n<h2 id=\"访问\"><a href=\"#访问\" class=\"headerlink\" title=\"访问\"></a>访问</h2><p>访问（连校园网，关梯子）：</p>\n<p><a href=\"http://192.10.84.209:33395/cloudNote/\">http://192.10.84.209:33395/cloudNote/</a></p>\n<p>账号：姓名小写拼音</p>\n<p>密码：123456</p>\n<p>效果：</p>\n<p><img src=\"/../image/%E4%BA%91%E7%AC%94%E8%AE%B0%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9/6.png\" alt=\"6\"></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clmuu294d00018vgn87jucu28","category_id":"clmuu294f00038vgn1806enux","_id":"clmuu294g000b8vgnfbs86vzo"},{"post_id":"clmuu294h000e8vgncdd8ge1f","category_id":"clmuu294i000g8vgn167h4n0m","_id":"clmuu294i000l8vgnhinhg3fn"},{"post_id":"clmuu294h000f8vgn431d64qw","category_id":"clmuu294i000j8vgna2xdfxy2","_id":"clmuu294j000q8vgn87vyhq79"},{"post_id":"clmuu294i000i8vgn1cpz0lan","category_id":"clmuu294i000g8vgn167h4n0m","_id":"clmuu294j000u8vgn80h7ea4x"}],"PostTag":[{"post_id":"clmuu294d00018vgn87jucu28","tag_id":"clmuu294f00048vgnehky5jnq","_id":"clmuu294g000c8vgn86m1cjun"},{"post_id":"clmuu294d00018vgn87jucu28","tag_id":"clmuu294g00088vgnbkw33hae","_id":"clmuu294h000d8vgn3jpmcfbs"},{"post_id":"clmuu294h000e8vgncdd8ge1f","tag_id":"clmuu294i000h8vgne05723el","_id":"clmuu294j000o8vgnhxwu3ynu"},{"post_id":"clmuu294h000e8vgncdd8ge1f","tag_id":"clmuu294i000k8vgn24trgdnm","_id":"clmuu294j000p8vgn18rh39vp"},{"post_id":"clmuu294h000e8vgncdd8ge1f","tag_id":"clmuu294g00088vgnbkw33hae","_id":"clmuu294j000s8vgn26kk0y6c"},{"post_id":"clmuu294h000f8vgn431d64qw","tag_id":"clmuu294i000n8vgnfptlhqi8","_id":"clmuu294j000t8vgn0qmkfg2d"},{"post_id":"clmuu294i000i8vgn1cpz0lan","tag_id":"clmuu294i000h8vgne05723el","_id":"clmuu294j000w8vgn4tas3ojy"},{"post_id":"clmuu294i000i8vgn1cpz0lan","tag_id":"clmuu294i000k8vgn24trgdnm","_id":"clmuu294j000x8vgnezb9exvl"},{"post_id":"clmuu294i000i8vgn1cpz0lan","tag_id":"clmuu294g00088vgnbkw33hae","_id":"clmuu294j000y8vgnhq9p480c"}],"Tag":[{"name":"hexo","_id":"clmuu294f00048vgnehky5jnq"},{"name":"教程","_id":"clmuu294g00088vgnbkw33hae"},{"name":"k8s","_id":"clmuu294i000h8vgne05723el"},{"name":"Kubernetes","_id":"clmuu294i000k8vgn24trgdnm"},{"name":"测试","_id":"clmuu294i000n8vgnfptlhqi8"}]}}